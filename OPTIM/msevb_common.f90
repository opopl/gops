!   OPTIM: A PROGRAM FOR OPTIMIZING GEOMETRIES AND CALCULATING REACTION PATHWAYS
!   COPYRIGHT (C) 1999-2006 DAVID J. WALES
!   THIS FILE IS PART OF OPTIM.
!   
!   OPTIM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
!   IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
!   THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
!   (AT YOUR OPTION) ANY LATER VERSION.
!   
!   OPTIM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL,
!   BUT WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
!   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.  SEE THE
!   GNU GENERAL PUBLIC LICENSE FOR MORE DETAILS.
!   
!   YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
!   ALONG WITH THIS PROGRAM; IF NOT, WRITE TO THE FREE SOFTWARE
!   FOUNDATION, INC., 59 TEMPLE PLACE, SUITE 330, BOSTON, MA  02111-1307  USA
!
MODULE MSEVB_COMMON
  IMPLICIT NONE
  SAVE
  
! PARAMETERS

  DOUBLE PRECISION, PARAMETER :: TRIGUNITY = 0.99999999999999D0
  DOUBLE PRECISION, PARAMETER :: MINUSTRIGUNITY = -0.99999999999999D0
! ARBITRARY LARGE FORCE FOR DISCONTINUITIES IN BOND ANGLE TERMS ETC
  DOUBLE PRECISION, PARAMETER :: LARGE_FORCE = 1.0D5 
  DOUBLE PRECISION, PARAMETER :: NUMERICALZEROLIMIT = 1.0D-15

! STORE INTERACTIONS OF VARIOUS KINDS

! COULOMB INTERACTIONS

! EACH_COULOMB(I,J) - ATOM I IS PART OF EXCHANGE SPECIES, ATOM J IS A NORMAL WATER ATOM
  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: EACH_COULOMB
! BOTH ATOMS ARE NORMAL WATER ATOMS
  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: WATER_INTER_COULOMB
! INTER_COULOMB(I,J) - ATOM I IS H3O+ ATOM, ATOM J IS A NORMAL H2O ATOM
  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: INTER_COULOMB
! SUM OF EACH_COULOMB FOR EACH ATOM
  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: ATOM_COULOMB

! H2O-H2O LJ INTERACTION
  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: LJR
! H2O-H3O+ LJ INTERACTION
  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: LJ_INTER

! H2O-H3O+ O-O REPULSION TERM
  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: REPULSE_INTER

! EXCHANGE SPECIES TERMS

  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: ZUNDEL_F
  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: ZUNDEL_G

!$OMP THREADPRIVATE (EACH_COULOMB,WATER_INTER_COULOMB,LJR,INTER_COULOMB,LJ_INTER,REPULSE_INTER,RMATRIX,ATOM_COULOMB)
!$OMP THREADPRIVATE (ZUNDEL_F,ZUNDEL_G)

!----IMPORTANT PARAMETERS NEEDED THROUGHOUT THE PROGRAM

  INTEGER :: NUM_HYD,NUM_EIG,GROUND_STATE,REDUCED_NUM_EIG,MAXNUMVBSTATES

  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: XX, YY, ZZ
  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: PSIX, PSIY, PSIZ  
  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: INTERATOMICR

!$OMP THREADPRIVATE (GROUND_STATE,REDUCED_NUM_EIG,MAXNUMVBSTATES,XX,YY,ZZ,PSIX,PSIY,PSIZ,INTERATOMICR)

! PARAMETERS FOR THE ASSIGNMENT OF THE VB STATES

  INTEGER :: SHELLSTOCOUNT
  DOUBLE PRECISION :: MAXHBONDLENGTH, MINHBONDANGLE

! GEOMETRY CHECK PARAMETER

  DOUBLE PRECISION :: OOCLASH_SQ

! EXCHANGE INTERACTIONS BETWEEN DIFFERENT VB STATES

  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: VIJEXCH

!$OMP THREADPRIVATE (VIJEXCH)

! ARRAY TO HOLD THE IDENTITIES OF THE EXCHANGE HYDRONIUM SPECIES

  INTEGER, ALLOCATABLE, DIMENSION(:,:,:) :: ZUNDEL_SPECIES
  LOGICAL, ALLOCATABLE, DIMENSION(:,:) :: STATESINTERACT  
  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: HAM, AIJ
  INTEGER, ALLOCATABLE, DIMENSION(:,:) :: ATMPL  
  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: GRSTWFU

!$OMP THREADPRIVATE (ZUNDEL_SPECIES,STATESINTERACT,HAM,AIJ,ATMPL,GRSTWFU)

! FLAG TO PRINT OUT COEFFICIENTS IN GROUND STATE AT THE END OF MINIMISATION

  LOGICAL :: PRINTCOEFFICIENTS

! MSEVB POTENTIAL PARAMETERS

  DOUBLE PRECISION, PARAMETER :: PI = 3.14159265358979D0
  DOUBLE PRECISION, PARAMETER :: RADS = PI/1.8D02
!----NEWISH TERMS:
  DOUBLE PRECISION, PARAMETER :: H2OINTEREPSILON = 0.1522D0
  DOUBLE PRECISION, PARAMETER :: H2OINTERSIGMA = 3.1506D0
!----AVOGADRO'S CONSTANT
  DOUBLE PRECISION, PARAMETER :: NA = 6.02214D23
!----DISS. ENERGY OF O-H BOND IN H3O (KJ/MOL)
  DOUBLE PRECISION, PARAMETER :: DOH = 266.3D0
!----EXPONENT PREFACTOR EQ O-H BOND LENGTH IN H3O (M)
  DOUBLE PRECISION, PARAMETER :: AOHEQ = 1.285D0
!----EQ O-H BOND LENGTH IN H3O (M)
  DOUBLE PRECISION, PARAMETER :: ROHEQ = 0.980D0
!----FORCE CONSTANT FOR H3O (KJ/MOL.DEG^2)
  DOUBLE PRECISION, PARAMETER :: KALPHA = 73.27D0
!----EQ H3O ANGLE (DEG)
  DOUBLE PRECISION, PARAMETER :: ALPHAEQ = 116.0D0*RADS
!----LJ EPSILON FOR H3O-H2O INTERMOLECULAR TERM (M)
  DOUBLE PRECISION, PARAMETER :: EPSILON_MSEVB = 0.155D0
!  DOUBLE PRECISION, PARAMETER :: EPSILON_MIX = 4.00D0*DSQRT(EPSILON_MSEVB*H2OINTEREPSILON)
  DOUBLE PRECISION, PARAMETER :: EPSILON_MIX = 4.00D0*0.15359362D0
!----LJ SIGMA FOR H3O-H2O INTERMOLECULAR TERM (M)
  DOUBLE PRECISION, PARAMETER :: SIGMA = 3.164D0 
  DOUBLE PRECISION, PARAMETER :: SIGMA_MIX = (H2OINTERSIGMA+SIGMA)/2.0D0
!----COULOMBIC OXYGEN CHARGE FOR H3O-H2O INTERMOLECULAR TERM (C)
  DOUBLE PRECISION, PARAMETER :: QINTERO =  -0.5D0
!----COULOMBIC OXYGEN CHARGE FOR H3O-H2O INTERMOLECULAR TERM (C)
  DOUBLE PRECISION, PARAMETER :: QINTERH = 0.5D0
!----O-O REPULSIVE COEFFICIENT
  DOUBLE PRECISION, PARAMETER :: BIG_B = 2.591D0
!----O-O REPULSIVE COEFFICIENT EXPONENT COEFFICIENT
  DOUBLE PRECISION, PARAMETER :: SMALL_B = 3.50D0
!----REPULSIVE EQ SEPARATION
  DOUBLE PRECISION, PARAMETER :: DOOEQ = 2.50D0
!----ALPHA TERM FROM OFF-DIAGONAL (F3) FITTING
  DOUBLE PRECISION, PARAMETER :: ALPHA_BLEH = 15.0D0
!----OFF-DIAGONAL EQ ROO TERM
  DOUBLE PRECISION, PARAMETER :: ROOEQ = 1.90D0
!----BETA TERM IN REPULSIVE THING (M)
  DOUBLE PRECISION, PARAMETER :: BETA = 4.500D0
!----WHO CARES
  DOUBLE PRECISION, PARAMETER :: BIG_ROOEQ = 3.14D0
!----ANOTHER FF-DIAGONAL EQ DOO TERM
  DOUBLE PRECISION, PARAMETER :: DOO = 2.875D0
!----P TERM IN OFF-DIAGONAL ELEMENTS
  DOUBLE PRECISION, PARAMETER :: P = 0.270D0
!----K TERM IN OFF-DIAGONAL ELEMENT (M^-2)
  DOUBLE PRECISION, PARAMETER :: KEXP = 11.50D0
!----GAMMA FOR OFF-DIAGONAL TERM (M^-2)
  DOUBLE PRECISION, PARAMETER :: GAMMA_MSEVB = 1.850D0
!----ZETA IN OFF-DIAGONAL TERMS (RAD^-2)
  DOUBLE PRECISION, PARAMETER :: ETA = 1.500D0
!----OMEGA IN OFF-DIAGONAL TERMS (DEG)
  DOUBLE PRECISION, PARAMETER :: OMEGAEQ = 174.3D0*RADS
!----THE COUPLING TERMS (KJ/MOL)
!----DELL
  DOUBLE PRECISION, PARAMETER :: VIJ = -32.925
!----EXCHANGE CHARGE FOR OXYGEN
  DOUBLE PRECISION, PARAMETER :: QEXCHO = -1.0005D-01
!----EXCHANGE CHARGE FOR HYDROGEN
  DOUBLE PRECISION, PARAMETER :: QEXCHH = 4.002D-02
!----DANG PARAMETERIZED TIP3P
  DOUBLE PRECISION, PARAMETER :: ALJ = 5.80D05
  DOUBLE PRECISION, PARAMETER :: CLJ = 5.25D02
  DOUBLE PRECISION, PARAMETER :: H2OROHEQ = 0.960D0
  DOUBLE PRECISION, PARAMETER :: H2OKTHETA = 68.087D0
!----DELL
  DOUBLE PRECISION, PARAMETER :: H2OKB = 105.9162D01
  DOUBLE PRECISION, PARAMETER :: THETAEQ = 104.5D0*RADS
!----DELL
  DOUBLE PRECISION, PARAMETER :: QTIP3P_O = -0.834D0
  DOUBLE PRECISION, PARAMETER :: QTIP3P_H = 0.417D0
  DOUBLE PRECISION, PARAMETER :: DAMPCHGE = 7.6D-01

!----COULOMB UNIT TERM
  DOUBLE PRECISION, PARAMETER :: FOURPIEO = 332.0638186797117D0

! DEBUGGING VARIABLES

!	REAL*8 LJ_VALUES(MXEIG), COULOMB_VALUES(MXEIG)
!	REAL*8 REP_VALUES(MXEIG)
!	REAL*8 H3O_INTRA_ENERGY(MXEIG), H2O_INTRA_ENERGY(MXEIG)
!	REAL*8 H3O_H2O_ENERGY(MXEIG), H2O_H2O_ENERGY(MXEIG)
!	REAL*8 LJ_FORCES(MXEIG,3*MXATOM), COULOMB_FORCES(MXEIG,3*MXATOM)
!	REAL*8 REP_FORCES(MXEIG,3*MXATOM)

!  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: H3O_INTRA_FORCES
!  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: H2O_INTRA_FORCES
!  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: H3O_H2O_FORCES
!  DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: H2O_H2O_FORCES

!	REAL*8 OFF_DIAG_FORCES(MXEIG,MXEIG,3*MXATOM)
!	REAL*8 OFF_DIAG_ENERGIES(MXEIG,MXEIG)

END MODULE MSEVB_COMMON













