C   OPTIM: A PROGRAM FOR OPTIMIZING GEOMETRIES AND CALCULATING REACTION PATHWAYS
C   COPYRIGHT (C) 1999-2006 DAVID J. WALES
C   THIS FILE IS PART OF OPTIM.
C
C   OPTIM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C   IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C   THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
C   (AT YOUR OPTION) ANY LATER VERSION.
C
C   OPTIM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL,
C   BUT WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
C   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.  SEE THE
C   GNU GENERAL PUBLIC LICENSE FOR MORE DETAILS.
C
C   YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
C   ALONG WITH THIS PROGRAM; IF NOT, WRITE TO THE FREE SOFTWARE
C   FOUNDATION, INC., 59 TEMPLE PLACE, SUITE 330, BOSTON, MA  02111-1307  USA
C
C
C***********************************************************************
C
      SUBROUTINE DUMPP(QL,ENERGY)
      USE COMMONS
      USE KEY
      USE MODCHARMM
      USE PORFUNCS
      IMPLICIT NONE
      DOUBLE PRECISION QL(3*NATOMS), S, ENERGY, OVEC(3), H1VEC(3), H2VEC(3)
      INTEGER J1, J2, ISTAT

      IF (.NOT.PRINTPTS) RETURN
C
C  WRITE OUT THE CARTESIAN COORDINATES TO FILE POINTS AND THE ENERGY TO
C  FILE ENERGIES
C
      WRITE(2,'(G30.20)') ENERGY
      S=1.0D0
      IF ((ZSYM(NATOMS).EQ.'AR').AND.(ZSYM(1).NE.'CA')) S=3.4D0
C     IF (ZSYM(1)(1:1).EQ.'W') THEN
C        WRITE(1,'(I5)') 3*NATOMS
C        WRITE(1,'(F20.10)') ENERGY
C     ENDIF
      DO J1=1,NATOMS
         IF (ZSYM(1)(1:1).EQ.'W') THEN
            IF (J1.LE.NATOMS/2) THEN  !  WCOMMENT NEW LINE
            CALL CONVERT(QL(3*(J1-1)+1),QL(3*(J1-1)+2),QL(3*(J1-1)+3),
     1            QL(3*(NATOMS/2+J1-1)+1),QL(3*(NATOMS/2+J1-1)+2),QL(3*(NATOMS/2+J1-1)+3),OVEC,H1VEC,H2VEC)
C  ! WCOMMENT
C    1            QL(3*(NATOMS+J1-1)+1),QL(3*(NATOMS+J1-1)+2),QL(3*(NATOMS+J1-1)+3),OVEC,H1VEC,H2VEC)
C           WRITE(1,'(A3,3G20.10)') 'O  ',OVEC(1),OVEC(2),OVEC(3)
C           WRITE(1,'(A3,3G20.10)') 'H  ',H1VEC(1),H1VEC(2),H1VEC(3)
C           WRITE(1,'(A3,3G20.10)') 'H  ',H2VEC(1),H2VEC(2),H2VEC(3)
            WRITE(1,'(2X,3G20.10)') OVEC(1),OVEC(2),OVEC(3)
            WRITE(1,'(2X,3G20.10)') H1VEC(1),H1VEC(2),H1VEC(3)
            WRITE(1,'(2X,3G20.10)') H2VEC(1),H2VEC(2),H2VEC(3)
            ENDIF
         ELSE IF (RINGPOLYMERT.AND.(RPSYSTEM(1:4).EQ.'AECK')) THEN
            WRITE(1,'(G20.10)') QL(J1)
         ELSE IF ((IATNUM(J1).NE.0).OR.AMBER.OR.CHRMMT.OR.UNRST) THEN
            J2=3*(J1-1)
            WRITE(1,'(1X,3G20.10)') QL(J2+1)*S,QL(J2+2)*S,QL(J2+3)*S
         ELSE IF (VARIABLES) THEN
            WRITE(1,'(G20.10)') QL(J1)
         ELSE
            J2 = 3*(J1-1)
            WRITE(1,'(1X,3G20.10)') QL(J2+1), QL(J2+2), QL(J2+3)
         ENDIF
      ENDDO
      CALL FLUSH(1,ISTAT)
      CALL FLUSH(2,ISTAT)
      RETURN
      END
