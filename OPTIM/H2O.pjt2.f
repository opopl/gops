      SUBROUTINE POTV(V,R1,R2,XCOS)
C
C     TRANSFORM GENERALISED COORDINATES TO THOSE FOR PARTICULAR
C     SYSTEM. THIS VERSION TRANSFORMS TO AB2 BONDLENGTH-BONDANGLE
C     COORDINATES. ALLOWANCE MUST BE MADE FOR THE NUMBERING OF THE ATOMS
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /MASS/ XMASS(3),G1,G2
C
C     (R = R . S = R'. T = THETA)
C
      DATA X1/1.0D0/,X0/0.0D0/,TINY/9.0D-15/,X2/2.0D0/
C
      IF (G1 .EQ. X0) THEN
C        BONDLENGTH BONDANGLE COORDINATES: ATOM 1 = ATOM 2
         Q1 = R1
         Q2 = R2
         THETA = ACOS(XCOS)
      ELSE IF (G2 .EQ. X0) THEN
C        SCATTERING COORDINATES: ATOM 2 = ATOM 3
         XX = R1 * G1
         YY = R1 * (X1 - G1)
         IF (R2 .EQ. X0 .OR. XCOS .GE. (X1 - TINY)) THEN
            Q1 = ABS(XX - R2)
            Q2 = (YY + R2)
            COST = -X1
         ELSE IF (XCOS .LE. (TINY - X1)) THEN
            Q1 = (XX + R2)
            Q2 = ABS(YY + R2)
            COST = X1
         ELSE
            Q1 = SQRT(XX*XX + R2*R2 - X2*XX*R2*XCOS)
            Q2 = SQRT(YY*YY + R2*R2 + X2*YY*R2*XCOS)
            COST = (Q1**2 + Q2**2 - R1**2) / (X2 * Q1 * Q2)
         ENDIF
         THETA = ACOS(COST)
      ELSE
C        GENERAL COORDINATES (INCLUDING RADAU): ATOM 1 = ATOM 2
         F1= X1/G1
         F2= X1/G2
         F12= X1 - F1*F2
         P1= R1*(X1-F1)/(G2*F12)
         P2= R2*(X1-F2)/(G1*F12)
         S1= R1-P1
         S2= R2-P2
         Q1= SQRT(P1*P1 + S2*S2 + X2*P1*S2*XCOS)/(X1-G1)
         Q2= SQRT(P2*P2 + S1*S1 + X2*P2*S1*XCOS)/(X1-G2)
         Q3= SQRT(P1*P1 + P2*P2 - X2*P1*P2*XCOS)
         COST = (Q1*Q1 + Q2*Q2 - Q3*Q3)/(X2*Q1*Q2)
         THETA = ACOS(COST)
      ENDIF
C
      CALL POTS(V,Q1,Q2,THETA)
C
      RETURN
      END
C
      SUBROUTINE POTS(V,Q1,Q2,THETA)
 
C     POTENTIAL PJT2 DUE POLYANSKY, JENSEN AND TENNYSON, 
C     J. CHEM. PHYS., 105, 6490-6497 (1996)
C     UPDATE OF POLYANSKY, JENSEN AND TENNYSON, J CHEM PHYS 101, 7651 (1994))
C     UNITS: HARTREE AND BOHR
 
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
 
C     RZ = OH EQUILIBRIUM VALUE
C     RHO = EQUILIBRIUM VALUE OF PI - BOND ANGLE(THETA)
 
      DATA TOANG/0.5291772/, CMTOAU/219474.624/
      DATA X1/1.0/
      DATA RHO1    /    75.50035308/
      DATA FA1     /     .00000000/
      DATA FA2     /18902.44193433/
      DATA FA3     /  1893.99788146/
      DATA FA4     /  4096.73443772/
      DATA FA5     /-1959.60113289/
      DATA FA6     /  4484.15893388/
      DATA FA7     /  4044.55388819/
      DATA FA8     / -4771.45043545/
      DATA FA9     /     0.00000000/
      DATA FA10    /     0.00000000/
      DATA RZ    /     .95792059/
      DATA A     /    2.22600000/
      DATA F1A1    /  -6152.40141181/
      DATA F2A1    / -2902.13912267/
      DATA F3A1    / -5732.68460689/
      DATA F4A1    /  953.88760833/
      DATA F11     / 42909.88869093/
      DATA F1A11   /  -2767.19197173/
      DATA F2A11   /  -3394.24705517/
      DATA F3A11   /     .00000000/
      DATA F13     /  -1031.93055205/
      DATA F1A13   /  6023.83435258/
      DATA F2A13   /     .00000000/
      DATA F3A13   /     .00000000/
      DATA F111    /     .00000000/
      DATA F1A111  /   124.23529382/
      DATA F2A111  /  -1282.50661226/
      DATA F113    /  -1146.49109522/
      DATA F1A113  /  9884.41685141/
      DATA F2A113  /  3040.34021836/ 
      DATA F1111   /  2040.96745268/
      DATA FA1111  /  .00000000/
      DATA F1113   /  -422.03394198/
      DATA FA1113  /-7238.09979404/
      DATA F1133   /     .00000000/
      DATA FA1133  /     .00000000/
      DATA F11111  / -4969.24544932/
      DATA F111111/  8108.49652354/
      DATA F71   /  90.00000000/
 
 
 
      DATA C1/50.0/,C2/10.0/,BETA1/22.0/,BETA2/13.5/,GAMMAS/0.05/,
     *     GAMMAA/0.10/,DELTA/0.85/,RHH0/1.40/
                 RHO=RHO1*3.141592654/180.000000000
      FA11=0.0
      F1A3=F1A1
      F2A3=F2A1
      F3A3=F3A1
      F4A3=F4A1
      F33=F11
      F1A33=F1A11
      F2A33=F2A11
      F333=F111
      F1A333=F1A111
      F2A333=F2A111
      F133=F113
      F1A133=F1A113
      F2A133=F2A113
      F3333=F1111
      FA3333=FA1111
      F1333=F1113
      FA1333=FA1113
      F33333=F11111
      F333333 =F111111
      F73     =F71
 
C     FIND VALUE FOR DR AND DS
      DR = TOANG*Q1 - RZ
      DS = TOANG*Q2 - RZ
 
C     TRANSFORM TO MORSE COORDINATES
      Y1 = X1 - EXP(-A * DR)
      Y3 = X1 - EXP(-A * DS)
 
C     TRANSFORM TO JENSENS ANGULAR COORDINATE
      CORO = DCOS(THETA) + DCOS(RHO)
 
C     NOW FOR THE POTENTIAL
      V0=(FA2+FA3*CORO+FA4*CORO**2+FA6*CORO**4+FA7*CORO**5)*CORO**2
      V0=V0+(FA8*CORO**6+FA5*CORO**3+FA9*CORO**7+FA10*CORO**8 )*CORO**2
      V0=V0+(                                    FA11*CORO**9 )*CORO**2
      FE1= F1A1*CORO+F2A1*CORO**2+F3A1*CORO**3+F4A1*CORO**4
      FE3= F1A3*CORO+F2A3*CORO**2+F3A3*CORO**3+F4A3*CORO**4
      FE11= F11+F1A11*CORO+F2A11*CORO**2
      FE33= F33+F1A33*CORO+F2A33*CORO**2
      FE13= F13+F1A13*CORO
      FE111= F111+F1A111*CORO+F2A111*CORO**2
      FE333= F333+F1A333*CORO+F2A333*CORO**2
      FE113= F113+F1A113*CORO+F2A113*CORO**2
      FE133= F133+F1A133*CORO+F2A133*CORO**2
      FE1111= F1111+FA1111*CORO
      FE3333= F3333+FA3333*CORO
      FE1113= F1113+FA1113*CORO
      FE1333= F1333+FA1333*CORO
      FE1133=       FA1133*CORO
      FE11111=F11111
      FE33333=F33333
      FE111111=F111111
      FE333333=F333333
      FE71    =F71
      FE73    =F73
      V   = V0 +  FE1*Y1+FE3*Y3
     1         +FE11*Y1**2+FE33*Y3**2+FE13*Y1*Y3
     2         +FE111*Y1**3+FE333*Y3**3+FE113*Y1**2*Y3
     3         +FE133*Y1*Y3**2
     4         +FE1111*Y1**4+FE3333*Y3**4+FE1113*Y1**3*Y3
     5         +FE1333*Y1*Y3**3+FE1133*Y1**2*Y3**2
     6         +FE11111*Y1**5+FE33333*Y3**5
     7         +FE111111*Y1**6+FE333333*Y3**6
     8         +FE71    *Y1**7+FE73    *Y3**7
C     MODIFICATION BY CHOI & LIGHT, J. CHEM. PHYS., 97, 7031 (1992).
      SQRT2=SQRT(2.0)
      XMUP1=SQRT2/3.0+0.5
      XMUM1=XMUP1-X1
      TERM=2.0*XMUM1*XMUP1*Q1*Q2*COS(THETA)
      R1=TOANG*SQRT((XMUP1*Q1)**2+(XMUM1*Q2)**2-TERM)
      R2=TOANG*SQRT((XMUM1*Q1)**2+(XMUP1*Q2)**2-TERM)
      RHH=SQRT(Q1**2+Q2**2-2.0*Q1*Q2*COS(THETA))
      RBIG=(R1+R2)/SQRT2
      RLIT=(R1-R2)/SQRT2
 
      ALPHA=(X1-TANH(GAMMAS*RBIG**2))*(X1-TANH(GAMMAA*RLIT**2))
      ALPHA1=BETA1*ALPHA
      ALPHA2=BETA2*ALPHA
      DRHH=TOANG*(RHH-DELTA*RHH0)
      DOLEG=     (1.4500-THETA)
C     IF (THETA.LE.0.64  ) V=0.1E17
C     IF((DR.LE.-0.4).AND.(THETA.LE.1.1)) V=0.1E17
C     IF((DS.LE.-0.4).AND.(THETA.LE.1.1)) V=0.1E17
C     IF (DS.LE. 0.0  ) V=0.1E17
      V = V + C1*EXP(-ALPHA1*DRHH) + C2*EXP(-ALPHA2*DRHH)
 
C     CONVERT TO HARTREE
      V=V/CMTOAU
      RETURN
      END
