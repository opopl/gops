MODULE INTCOMMONS
  USE MODAMBER9, ONLY : INTMINPERMT
  ! SOME GLOBAL VARIABLES FOR INTERNALS
  IMPLICIT NONE  

  ! KEYWORDS
  LOGICAL :: NATINT = .FALSE., INTNEWT = .TRUE.
  LOGICAL :: OLDINTMINPERMT=.FALSE. !THIS IS BAD FOR AMBER
  LOGICAL :: BBCART = .FALSE., INTINTERPT = .FALSE., INTERPSIMPLE = .FALSE.
  LOGICAL :: INTERPCHOICE = .FALSE.
  INTEGER :: NINTIM = 100 ! NUMBER OF IMAGES TO DEFINE PATH IN INTERNALS INTERPOLATION
  ! STARTING FROM THIS RESIDUE USE CARTESIANS
  ! IF CARTRESSTART IS LESS THAN ZERO, IT WILL BE SET TO NRES+1
  INTEGER :: CARTRESSTART = -1, CARTATMSTART = -1
  DOUBLE PRECISION :: MINBACKTCUT = 1.0D-4, INTERPBACKTCUT = 1.0D-8
  LOGICAL :: PRINTCOORDS
  LOGICAL :: BACKTPRINTERR = .FALSE.
  LOGICAL :: DESMINT = .FALSE., CHICDNEB=.FALSE.
  INTEGER :: NURINGS=0, URINGS(100,0:6)
  INTEGER :: NUBONDS=0, UBONDS(100,2)
  LOGICAL :: USEPARFILE = .FALSE.
  CHARACTER*100 :: INTPARFILE = 'NATURALS-NOH.PAR'

  DOUBLE PRECISION, PARAMETER :: PI=3.141592653589793D0, TWOPI = 2*PI

  ! -----------------------
  ! NATURAL INTERNALS STUFF
  ! -----------------------
  ! NUMBER OF BONDS, CENTERS, RINGS, FUSED RINGS, LINEAR DIHEDRALS, 
  ! IMPROPER DIHEDRALS, CARTESIAN ATOMS, AND INDIVIDUAL DIHEDRAL ANGLES
  INTEGER :: NBDS, NCNT, NRNG, NFRG, NLDH, NIMP, NCRT, NDIH
  ! ANGLE AND TORSION COEFFICIENTS DEFINING THE NATURAL COORDINATES
  DOUBLE PRECISION :: COEFF(30,6,6) 
  !     CENTERS LISTS TYPE OF CENTER, THEN CENTER ATOM FOLLOWED BY NONTERMINAL ATOMS
  !     FOLLOWED BY TERMINAL ATOMS; RINGS LISTS ATOMS IN RING IN ORDER; 
  !     FRINGS LISTS ATOMS INVOLVED IN A 
  !     FUSED RING, THE TWO BRIDGE ATOMS FIRST; LINDIH LISTS M, N, A, B, 
  !     X_I, Y_J FOR X_M -- A -- B -- Y_N; IMPDIH LISTS ATOMS IN AN IMPROPER DIHEDRAL 
  !     ('WAG') COORDINATE; STARTING WITH CENTRAL ATOM AND ENDING WITH THE WAGGING
  !     ATOM.
  !     ATOMXPOSINC GIVES, FOR A GIVEN CENTER TYPE, THE POSITION OF THE X COORDINATE 
  !     OF AN ATOM WHEN FOR EACH NATURAL ANGLE-SUM COORDINATE ALL THE ATOMS INVOLVED 
  !     ARE LISTED IN ORDER WITH TRIPLETS FOR THE X,Y,Z COORDINATES
  INTEGER, ALLOCATABLE :: CENTERS(:,:), RINGS(:,:), FRINGS(:,:), LINDIH(:,:), &
       & IMPDIH(:,:), CARTATMS(:)
  INTEGER, ALLOCATABLE :: CENTER2(:) !MSB50 - LISTS CENTER NOS IF CENTERTYP IS 2
  INTEGER :: NCNT2 
  INTEGER :: ATOMXPOSINC(10,5,5)

  ! -------------------
  DOUBLE PRECISION, ALLOCATABLE, TARGET :: DIHINFOSINGLE(:), DIHINFO(:,:)
  DOUBLE PRECISION, POINTER :: PREVDIH(:)
  LOGICAL :: ALIGNDIR = .FALSE.
  LOGICAL, ALLOCATABLE :: BACKBONE(:), USECART(:)
  INTEGER :: NINTC = 0
  INTEGER :: KD, NNZ
  DOUBLE PRECISION :: BACKTCUTOFF

  ! COPIED FROM CHARMM COMMON BLOCKS
  INTEGER :: TOTBOND, TOTANG, TOTDIH, TOTRES! TOTAL BONDS, ANGLES, DIHEDRALS, RESIDUES IN MOLECULE
  INTEGER, ALLOCATABLE :: RESSTARTS(:) ! STARTING ATOMS (N-1) FOR EACH RESIDUE
  CHARACTER*8, ALLOCATABLE :: ATMTYPES(:) ! LIST OF ATOM TYPES
  CHARACTER*8, ALLOCATABLE :: RESLIST(:) ! LIST OF RESIDUES
  INTEGER:: STARTLINDH
  INTEGER, ALLOCATABLE :: MBBONDNUM(:), MBADJACENT(:,:)
  INTEGER, ALLOCATABLE :: BONDNUM(:), ADJACENT(:,:)
  INTEGER, ALLOCATABLE :: PERMNEIGHBOURS(:,:), PERMCHAIN(:,:)
  DOUBLE PRECISION, ALLOCATABLE :: PERMNANGLE(:,:)
  INTEGER, ALLOCATABLE :: GLYDIH(:,:)
  INTEGER ::NGLYDIH
  LOGICAL :: GLYCART = .FALSE.
  LOGICAL :: INTDISTANCET = .FALSE. !DISTANCES FROM MINPERMDIST IN DIHEDRAL ANGLE METRIC

END MODULE INTCOMMONS
