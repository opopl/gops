      SUBROUTINE REP_CONTACT(XCORD)

!     THIS SUBROUTINE WILL READ IN THE EXPERIMENTAL PHIVALUES 
!     AND WILL ALSO PROVIDE THE SETUP FOR THE ARRAY THAT 
!     CONTAINS THE INFORMATION ON CONTACTS
!     IT WILL ALSO READ IN LAMBDAS

!     DECLARING VARIABLES
      USE AMHGLOBALS,  ONLY: AMHMAXSIZ,MAXCRD,NMRES,REP_PHI_EXP, &
             N_REP_CON,REP_CON_2_RES,REP_LAMBDA,IRES, &
         REP_CUT_OFF,I_REP_LAMBDA_UNIFORM,IPHI,  &
         ICONTACTS
       DOUBLE PRECISION, INTENT(IN):: XCORD(AMHMAXSIZ,3,MAXCRD)
      DOUBLE PRECISION :: R
      INTEGER :: I,I_RES,J_RES,I_ATOM,J_ATOM

!     READ IN PHI VALUES AND STORE THEM IN REP_PHI_EXP(I)
      OPEN(IPHI,FILE='PHIVALUES',STATUS='OLD')
      DO 10 I=1,NMRES
      READ(IPHI,*) REP_PHI_EXP(I)
10    CONTINUE
      CLOSE(IPHI)

!     READ IN LAMBDA VALUES AND STORE THEM IN LAMBDA(I)
      IF (I_REP_LAMBDA_UNIFORM) THEN
        REP_LAMBDA(:)=REP_LAMBDA(1)
      ELSE
        OPEN(2,FILE='LAMBDAS',STATUS='OLD')
        DO 15 I=1,NMRES
        READ(2,*) REP_LAMBDA(I)
15      CONTINUE
        CLOSE(2)
      ENDIF


!     NOW WE NEED TO CALCULATE THE CONTACTS MADE IN THE CRYSTAL STRUCTURE 
!     AND STORE THEM IN THE ARRAY REP_CON_2_RES
!     WE USE AS CUTOFF DISTANCE REP_CUT_OFF ANGSTROM
!     WE HAVE THE RADIUS OF THE CRYSTAL STRUCTURE


      N_REP_CON=0

      DO 20 I_RES=1,NMRES
      IF (IRES(I_RES).EQ.8) THEN   !NOTE 'IRES' IS IDENTITY, AND 'I_RES' IS RESIDUE COUNTER
        I_ATOM=1     ! BASE DISTANCE ON C_ALPHA FOR GLYCINE
      ELSE
        I_ATOM=2     ! BASE DISTANCE ON C_BETA OTHERWISE
      ENDIF
      DO 30 J_RES=1,I_RES-2
      IF (IRES(J_RES).EQ.8) THEN
        J_ATOM=1     
      ELSE
        J_ATOM=2     
      ENDIF
      R=SQRT(SUM((XCORD(I_RES,:,I_ATOM)-XCORD(J_RES,:,J_ATOM))**2))
      IF ( R <= REP_CUT_OFF) THEN
      N_REP_CON(I_RES)=N_REP_CON(I_RES)+1
      REP_CON_2_RES(I_RES,N_REP_CON(I_RES))=J_RES
      END IF
30    CONTINUE
      DO 40 J_RES=I_RES+2,NMRES
      IF (IRES(J_RES).EQ.8) THEN
        J_ATOM=1     
      ELSE
        J_ATOM=2     
      ENDIF
      R=SQRT(SUM((XCORD(I_RES,:,I_ATOM)-XCORD(J_RES,:,J_ATOM))**2))
      IF ( R <= REP_CUT_OFF) THEN
      N_REP_CON(I_RES)=N_REP_CON(I_RES)+1
      REP_CON_2_RES(I_RES,N_REP_CON(I_RES))=J_RES
      END IF
40    CONTINUE
20    CONTINUE

      OPEN(ICONTACTS,FILE='CONTACTS', STATUS='NEW')
      DO I=1,NMRES
      WRITE(ICONTACTS,*) N_REP_CON(I),REP_CON_2_RES(I,:)
      ENDDO
      CLOSE(ICONTACTS)
     

      END
