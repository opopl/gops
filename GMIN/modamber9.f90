      MODULE MODAMBER9 
!      USE COMMONS, ONLY : NATOMS        ! COORDS DELETED

      IMPLICIT NONE
      SAVE

! STUFF FOR DUMPING NORMAL MODE INFO
      LOGICAL, DIMENSION(:), ALLOCATABLE :: DUMPMODEN
      LOGICAL :: KTWNT
      DOUBLE PRECISION :: KTWN

      LOGICAL MDSTEPT, READCOORDS, NOCISTRANSRNA, CHECKCISTRANSALWAYS, GOODSTRUCTURE1, GOODSTRUCTURE2, AMBERENERGIEST
      LOGICAL NOCISTRANSDNA, UACHIRAL, SETCHIRAL, CHECKCISTRANSALWAYSRNA, CHECKCISTRANSALWAYSDNA
      CHARACTER(LEN=20) :: AMBERSTR
      CHARACTER(LEN=8)  :: AMBERSTR1
      DOUBLE PRECISION, DIMENSION(:), ALLOCATABLE :: COORDS1, COORDS, ATMASS1
      INTEGER, DIMENSION(:), ALLOCATABLE :: CISARRAY1, CISARRAY2, CHIARRAY1, CHIARRAY2
      CHARACTER(LEN=81) :: PRMTOP
      DOUBLE PRECISION, PARAMETER :: TEMPPARAM = 0.0000001
!      INTEGER   NATOM, IREST, NTB
!      DOUBLE PRECISION    TT,CRD(3*656),VEL(3,656)
! LIGAND MOVE PARAMETERS
! LIGROTSCALE = SCALING FACTOR FOR RIGID ROTATIONS (0->1)
! LIGCARTSTEP = SIZE OF RANDOM CARTESIAN COORDINATE MOVE FOR LIGAND 
! LIGTRANSSTEP = SIZE OF RIGID TRANSLATION MOVE FOR LIGAND 
! LIGMOVEFREQ = FREQUENCY OF LIGAND MOVES I.E. 1 = EVERY STEP
! DOLIGMOVE = LOGICAL SWITCH TO TELL AMBERINTERFACE.F TO DO THE LIGAND MOVE
      DOUBLE PRECISION :: LIGROTSCALE, LIGCARTSTEP, LIGTRANSSTEP
      INTEGER :: LIGMOVEFREQ
      LOGICAL :: DOLIGMOVE=.FALSE.
! END OF LIGAND MOVE PARAMETERS

! ROTAMER MOVE PARAMETERS
! ROTAMERT = LOGICAL SWITCH INDICATING ROTAMER MOVES SHOULD BE USED
! ROTMAXCHANGE = MAXIMUM NUMBER OF ROTAMERS TO CHANGE IN ONE STEP
! ROTPSELECT = THE PROBABILITY OF CHOOSING A PARTICULAR ROTAMER
! ROTOCCUW = THE AMOUNT THE OCCUPATION FREQUENCY AFFECTS THE ROTAMER SELECTION I.E.
!            ROTOCCUW = 0.0 -> ALL ROTAMERS POSSIBLE
!            ROTOCCUW = 0.004 -> ONLY ROTAMERS WITH A > 0.4% OCCUPATION SELECTED
! ROTCENTRE = RESIDUE ID USED TO SPECIFY CENTRE OF ROTAMER MOVES (LIGAND MAYBE?)
! ROTCUTTOFF = SELECTION PROBABILITY DECAYS LINEARLY FROM THE CENTRE (ABOVE) TO THE CUTOFF
      LOGICAL :: ROTAMERT
      INTEGER :: ROTMAXCHANGE, ROTCENTRE
      DOUBLE PRECISION :: ROTPSELECT, ROTOCCUW, ROTCUTOFF 
! END OF ROTAMER MOVE PARAMETERS

! GROUP ROTATION MOVE PARAMETERS
      INTEGER :: GROUPROTFREQ, NGROUPS
      LOGICAL :: GROUPROTT, DOGROUPROT=.FALSE.
      CHARACTER(LEN=10), ALLOCATABLE :: ATOMGROUPNAMES(:)
      INTEGER, ALLOCATABLE :: ATOMGROUPAXIS(:,:)
      DOUBLE PRECISION, ALLOCATABLE :: ATOMGROUPSCALING(:),ATOMGROUPPSELECT(:)
      LOGICAL, ALLOCATABLE :: ATOMGROUPS(:,:)
      
! END OF GROUP ROTATION MOVE PARAMETERS
      INTEGER :: N_AMB_CALLS=0      
!      CHARACTER(20) AMBERPRMTOP 
!      DOUBLE PRECISION XBAR, YBAR, ZBAR
!   DOUBLE PRECISION, DIMENSION(:), ALLOCATABLE        :: Y
   DOUBLE PRECISION,  DIMENSION(:), ALLOCATABLE :: X
   INTEGER, DIMENSION(:), ALLOCATABLE :: IX, IPAIRS
   CHARACTER(LEN=4), DIMENSION(:), ALLOCATABLE :: IH
   INTEGER :: MYUNITNEW,MYUNIT2,MDCRD_UNIT,MDINFO_UNIT,AMBPDB_UNIT,AMBXYZ_UNIT,AMBRST_UNIT,AMBFINALIO_NODE
LOGICAL MASTER
COMMON/EXTRA_LOGICAL/MASTER


INTEGER IREDIR(8)
COMMON/NMRRDR/REDIR,IREDIR

INTEGER NMROPT,IPRINT,NOESKP,ISCALE,IPNLTY,IUSE,MAXSUB,JAR
DOUBLE PRECISION SCALM,PENCUT,ENSAVE,TAUSW,EBDEV,EADEV,DRJAR
COMMON/NMR1AMBER/SCALM,PENCUT,ENSAVE,TAUSW,EBDEV,EADEV,DRJAR, &
      NMROPT,IPRINT,NOESKP,ISCALE,IPNLTY,IUSE,MAXSUB,JAR

INTEGER     NTPR,NTWR,NTWX,NTWV,NTWE,NTPP,IOUTFM,NTWPRT,NTAVE
COMMON/HULP/NTPR,NTWR,NTWX,NTWV,NTWE,NTPP,IOUTFM,NTWPRT,NTAVE

!  PARAMETERS FOR LES:

INTEGER MAXLES,MAXLESTYP,MAXLESADJ
PARAMETER (MAXLES=500000)
PARAMETER (MAXLESTYP=100)
PARAMETER (MAXLESADJ=100000)

INTEGER BC_LESR,BC_LESI
PARAMETER( BC_LESI=1+MAXLES*3+MAXLESADJ*2+1)
PARAMETER (BC_LESR=MAXLESTYP*MAXLESTYP+1)

DOUBLE PRECISION LESFAC(MAXLESTYP*MAXLESTYP),LFAC

! FOR SEPARATE LES AND NON-LES TEMPERATURE COUPLING

DOUBLE PRECISION EKINLES0,TEMP0LES,RNDFLES,SDFACLES
DOUBLE PRECISION SCALTLES,TEMPSULES,EKELES,RSDLES
DOUBLE PRECISION EKMHLES,EKPHLES

COMMON/LESR/LESFAC,TEMP0LES

LOGICAL BELLY, ERSTOP, QSETUP, QPSANDER

LOGICAL NEWSTYLE,OK
INTEGER BC_MDI  ! SIZE IN INTEGERS OF COMMON BLOCK MDI
INTEGER BC_MDR  ! SIZE IN REALS OF COMMON BLOCK MDR

      INTEGER ISGSTA,ISGEND,IPS,NNBIPST,NNBIPS
      COMMON/DTSGI/ISGSTA,ISGEND,IPS,NNBIPST,NNBIPS

      LOGICAL TSGLD,TLANGV,TEIPS,TVIPS
      COMMON/DTSGL/TSGLD,TLANGV,TEIPS,TVIPS

   ! RUNMIN/TRAJENE VAR
   DOUBLE PRECISION CARRMS


!+ SPECIFICATION AND CONTROL OF AMBER'S WORKING PRECISION


DOUBLE PRECISION BOX,CUT,SCNB,SCEE,DIELC,RAD,WEL,RADHB,WELHB, &
      CUTCAP,XCAP,YCAP,ZCAP,FCAP,RWELL,XBOX0,YBOX0,ZBOX0
COMMON/BOXR/BOX(3),CUT,SCNB,SCEE,DIELC,XBOX0,YBOX0,ZBOX0, &
      CUTCAP,XCAP,YCAP,ZCAP,FCAP,RWELL, &
      RAD(100),WEL(100),RADHB(200),WELHB(200)

! ... INTEGERS:

INTEGER NTB,IFBOX,NUMPK,NBIT,IFCAP,NATCAP,ISFTRP
COMMON/BOXI/NTB,IFBOX,NUMPK,NBIT,IFCAP,NATCAP,ISFTRP

DOUBLE PRECISION EXTRABOXDIM
!PARAMETER (EXTRABOXDIM=30.D0)

! ... FLOATS:

DOUBLE PRECISION T,DT,TEMP0,TAUTP,PRES0,COMP,TAUP,TEMP,TEMPI, & !9
      TOL,TAUR,DX0,DRMS,VLIMIT,RBTARG(9),TMASS,TMASSINV,  & !25
          KAPPA,OFFSET,SURFTEN,GAMMA_LN,EXTDIEL,INTDIEL,RDT,  & !32
          GBALPHA,GBBETA,GBGAMMA,CUT_INNER,CLAMBDA,SALTCON,  & !38
          SOLVPH,RGBMAX,FSMAX,RESTRAINT_WT, &  !42
          SKMIN,SKMAX,VFAC,GBNECKSCALE,V11,V12,V22,KEVB,EVBT,ARAD   !52
PARAMETER (BC_MDR=52)
COMMON/MDR/T,DT,TEMP0,TAUTP,PRES0,COMP,TAUP,TEMP,TEMPI, &
      TOL,TAUR,DX0,DRMS,VLIMIT,RBTARG,TMASS,TMASSINV, &
      KAPPA,OFFSET,SURFTEN,GAMMA_LN,EXTDIEL,INTDIEL,RDT, &
      GBALPHA,GBBETA,GBGAMMA,CUT_INNER,CLAMBDA,SALTCON, &
      SOLVPH,RGBMAX,FSMAX,RESTRAINT_WT,SKMIN,SKMAX,VFAC,GBNECKSCALE, &
      V11,V12,V22,KEVB,EVBT,ARAD

! ... STRINGS:

CHARACTER(LEN=4) IWTNM,IOWTNM,IHWTNM
CHARACTER(LEN=256) RESTRAINTMASK,BELLYMASK,TGTFITMASK,TGTRMSMASK,NOSHAKEMASK
COMMON/MDS/ RESTRAINTMASK,BELLYMASK,TGTFITMASK,TGTRMSMASK,NOSHAKEMASK,  &
            IWTNM,IOWTNM,IHWTNM(2)

INTEGER NRP,NSPM,IG,NTX,NTCX,           &!5
      NTXO,NTT,NTP,NTR,INIT,             &!10
      NTCM,NSCM,ISOLVP,NSOLUT,KLAMBDA,   &!15
      NTC,NTCC,NTF,NTID,NTN,             &!20
      NTNB,NSNB,NDFMIN,NSTLIM,NRC,       &!25
      NTRX,NPSCAL,IMIN,MAXCYC,NCYC,      &!30
      NTMIN,IREST,JFASTW,                &!33
      IBGWAT,IENWAT,IORWAT,              &!36
      IWATPR,NSOLW,IGB,ALPB,IYAMMP,           &!41
      GBSA,VRAND,IWRAP,NRESPA,IRESPA,NRESPAI,ICFE,  &!48
      RBORNSTAT,IVCAP,ICONSTREFF,        &!51
      NEB,VV,TMODE,IPOL,IESP,IEVB,NODEID,NUM_NOSHAKE,    &!59
      IDECOMP,ICNSTPH,NTCNSTPH,MAXDUP,NUMEXCHG,REPCRD,NUMWATKEEP     !66
PARAMETER (BC_MDI=66)

COMMON/MDIAMBER/NRP,NSPM,IG, &
      NTX,NTCX,NTXO,NTT,NTP,NTR,INIT,NTCM,NSCM, &
      ISOLVP,NSOLUT,NTC,NTCC,NTF,NTID,NTN,NTNB,NSNB,NDFMIN, &
      NSTLIM,NRC,NTRX,NPSCAL,IMIN,MAXCYC,NCYC,NTMIN, &
      IREST,JFASTW,IBGWAT,IENWAT,IORWAT, &
      IWATPR,NSOLW,IGB,ALPB,IYAMMP,GBSA,VRAND,NUMEXCHG,REPCRD,NUMWATKEEP, &
      IWRAP,NRESPA,IRESPA,NRESPAI,ICFE,RBORNSTAT, &
      IVCAP,ICONSTREFF,IDECOMP,KLAMBDA,ICNSTPH,NTCNSTPH,MAXDUP,NEB,VV, &
          TMODE,IPOL,IESP,IEVB,NODEID,NUM_NOSHAKE


CHARACTER(LEN=4096) GROUPBUFFER
CHARACTER(LEN=256) MDIN, MDOUT, INPCRD, PARM, RESTRT, &
      REFC, MDVEL, MDEN, MDCRD, MDINFO, NMRF, MINCOR, &
      VECS, RADII, FREQE,REDIR(8),RSTDIP,MDDIP,INPDIP,GROUPS,GPES, &
      CPIN, CPOUT, CPRESTRT, EVBIN, EVBOUT, MMTSB_SETUP_FILE

CHARACTER OWRITE, FACC
COMMON /FILES/ GROUPBUFFER, MDIN, MDOUT, INPCRD, PARM, RESTRT, &
      REFC, MDVEL, MDEN, MDCRD, MDINFO, NMRF, MINCOR, &
      VECS, RADII, FREQE, OWRITE, FACC,RSTDIP,MDDIP,INPDIP,GROUPS,GPES, &
      CPIN, CPOUT, CPRESTRT, EVBIN, EVBOUT, MMTSB_SETUP_FILE

INTEGER IER
INTEGER       NATOM,NRES,NBONH,NBONA,NTHETH,NTHETA,NPHIH, &
      NPHIA,NNB,NTYPES,NCONP,MAXMEM,NWDVAR,NPARM, &
      NATC,NATTGTFIT,NATTGTRMS,IBELLY,NATBEL,ISHAKE,NMXRS, &
      MXSUB,NATYP,NPDEC,I02,I04,I06,I08,I10, &
      IIBH,IJBH,IICBH,IIBA,IJBA,IICBA, &
      I24,I26,I28,I30,I32,I34,I36,I38,I40, &
      I42,I44,I46,I48,I50,I52,I54,I56,I58,IBELLYGP, &
      ICNSTRGP,ITGTFITGP,ITGTRMSGP,I64,I65,I68, &
      I70,I72,I74,I76,I78,I79,I80,I82,I84,I86, &
      ICPSTINF,ICPRESST,ICPTRSCT, ICPPTCNT, &
      L15,LWINV,LPOL,LCRD,LFORCE,L36,LVEL,LVEL2,L45,L50, &
      LCRDR,L60,L65,LMASS,L75,L80,L85,L90,L95,L96,L97,L98,L99,LFRCTMP, &
      L105,L110,L115,L120,L125,L130,L135,L140,L145,L150, &
      L165,L170,L175,L180,L185,L186,L187,L188,L189,L190, &
      LCPCRG,LCPENE, &
      M02,M04,M06,M08,M10,M12,M14,M16,M18,I01, &
      IIFSTWT,IIFSTWR,NREALB,NINTB,NHOLB,NPAIRB,LASTR,LASTI,LASTH, &
      LASTPR,NBPER,NGPER,NDPER,IFPERT,LPOLP, NCOPY, &
      IMASK1,IMASK2,NUMADJST,MXADJMSK,ICPHIDX,ICPTPAIR,LFSG,LVSG,NOSHAKE

!  1        2         3         4         5      6     7     8      9      10
COMMON/MEMORY/ &
 NATOM   ,NRES     ,NBONH    ,NBONA   ,NTHETH,NTHETA,NPHIH ,                       & ! 7
 NPHIA   ,NNB      ,NTYPES   ,NCONP   ,MAXMEM,NWDVAR,NPARM ,                       & !14
 NATC    ,NATTGTFIT,NATTGTRMS,IBELLY  ,NATBEL,ISHAKE,NMXRS ,                       & !21
 MXSUB   ,NATYP    ,NPDEC    ,I02     ,I04   ,I06   ,I08   ,I10   ,                & !29
 IIBH    ,IJBH     ,IICBH    ,IIBA    ,IJBA  ,IICBA ,                              & !35
 I24     ,I26      ,I28      ,I30     ,I32   ,I34   ,I36   ,I38   ,I40   ,         & !44
 I42     ,I44      ,I46      ,I48     ,I50   ,I52   ,I54   ,I56   ,I58   ,IBELLYGP,& !54
 ICNSTRGP,ITGTFITGP,ITGTRMSGP,I64     ,I65   ,I68   ,                              & !60
 I70     ,I72      ,I74      ,I76     ,I78   ,I79   ,I80   ,I82   ,                & !68
 I84     ,I86      ,                                                               & !70
 ICPSTINF,ICPRESST ,ICPTRSCT ,ICPPTCNT,                                            & !74
 L15      ,LWINV   ,LPOL     ,LCRD    ,LFORCE,L36   ,LVEL  ,LVEL2 ,                & !82
 L45     ,L50      ,                                                               & !84
 LCRDR   ,L60      ,L65      ,LMASS   ,L75   ,L80   ,L85   ,L90   ,L95   ,L96   ,  & !94
 L97     ,L98      ,L99      ,LFRCTMP  ,                                           & !98
 L105    ,L110     ,L115     ,L120    ,L125  ,L130  ,L135  ,L140  ,L145  ,L150  ,  & !108
 L165    ,L170     ,L175     ,L180    ,L185  ,L186  ,L187  ,L188  ,L189  ,L190  ,  & !118
 LCPCRG  ,LCPENE   ,                                                               & !120
 M02     ,M04      ,M06      ,M08     ,M10   ,M12   ,M14   ,M16   ,M18   ,I01   ,  & !130
 IIFSTWT ,IIFSTWR  ,NREALB   ,NINTB   ,NHOLB ,NPAIRB,LASTR ,LASTI ,LASTH ,         & !139
 LASTPR  ,NBPER   ,NGPER     ,NDPER   ,IFPERT,LPOLP ,NCOPY ,                       & !146
 IMASK1  ,IMASK2   ,NUMADJST ,MXADJMSK,ICPHIDX,ICPTPAIR,LFSG,LVSG,NOSHAKE            !155

INTEGER VERBOSE,NETFRC,     EW_TYPE,    VDWMETH, &
      PERIODIC,  USE_PME,    OPT_INFL,   ISCHRGD, FIX_DIP, &
      FIX_QUAD,  MPOLTYPE,   INDUCED,    FRAMEON, CHNGMASK, &
      SCALDIP

COMMON/EWCNTRL/ &
      VERBOSE,   NETFRC,     EW_TYPE,    VDWMETH,    &! 4
      PERIODIC,  USE_PME,    OPT_INFL,   ISCHRGD, FIX_DIP,    &!9
      FIX_QUAD,  MPOLTYPE,   INDUCED,    FRAMEON, CHNGMASK,   &!14
      SCALDIP


!INTEGER    MCHRG,  MAMASS,  MRK,    MREQ,   MTK, &
!      MTEQ,   MFK,     MFPK,   MQEQ,   MPK, &
!      MPN,    MPHASE,  MSOLTY, MCN1,   MCN2, &
!      MASOL,  MBSOL,   MHBCUT, MXREF,  MSF, &
!      MOMEGA, MGRAPH,  MIAC,   MIBLO,  MICO, &
!      MLBRES, MIPRES,  MIBH,   MJBH,   MICBH, &
!      MIBA,   MJBA,    MICBA,  MITH,   MJTH, &
!      MKTH,   MICTH,   MITA,   MJTA,   MKTA, &
!      MICTA,  MIPH,    MJPH,   MKPH,   MLPH, &
!      MICPH,  MIPA,    MJPA,   MKPA,   MLPA, &
!      MICPA,  MINB,    MSYMBL, MITREE, MGROUP, &
!      MIGRES, MIAR1,   MX,     MF,     MH, &
!      MNBEL,  MXBEL,   MIAR2,  MCSCR,  MCVAL, &
!      MCVEC,  MDD,     MB,     MROOTS, MVECT, &
!      MXDIR,  MWREF,   MIGRP2, MA,     MWR, &
!      MWI,    MZ,      MFV1,   MIV1,   MHRAD, &
!      MGAM,   MWINV,   MKPVT,  MXINIT, MCN114, &
!      MCN214, MJOIN,   MROTAT, MPOL


!COMMON /POINTR/   MCHRG,  MAMASS,  MRK,    MREQ,   MTK, &
!      MTEQ,   MFK,     MFPK,   MQEQ,   MPK, &
!      MPN,    MPHASE,  MSOLTY, MCN1,   MCN2, &
!      MASOL,  MBSOL,   MHBCUT, MXREF,  MSF, &
!      MOMEGA, MGRAPH,  MIAC,   MIBLO,  MICO, &
!      MLBRES, MIPRES,  MIBH,   MJBH,   MICBH, &
!      MIBA,   MJBA,    MICBA,  MITH,   MJTH, &
!      MKTH,   MICTH,   MITA,   MJTA,   MKTA, &
!      MICTA,  MIPH,    MJPH,   MKPH,   MLPH, &
!      MICPH,  MIPA,    MJPA,   MKPA,   MLPA, &
!      MICPA,  MINB,    MSYMBL, MITREE, MGROUP, &
!      MIGRES, MIAR1,   MX,     MF,     MH, &
!      MNBEL,  MXBEL,   MIAR2,  MCSCR,  MCVAL, &
!      MCVEC,  MDD,     MB,     MROOTS, MVECT, &
!      MXDIR,  MWREF,   MIGRP2, MA,     MWR, &
!      MWI,    MZ,      MFV1,   MIV1,   MHRAD, &
!      MGAM,   MWINV,   MKPVT,  MXINIT, MCN114, &
!      MCN214, MJOIN,   MROTAT, MPOL

   DOUBLE PRECISION ENE(51)
   INTEGER NATIVE,NR3,NR
   ! NMRCAL VARS
   DOUBLE PRECISION F,ENMR,DEVDIS,DEVANG,DEVTOR,AG,BG,CG
   INTEGER NUMPHI,NTTYP,NHB
! COMMON BLOCK CONTAINING VARIABLES RELATING TO NMR RESTRAINTS.

INTEGER       INTREQ,IRLREQ,LNMR01,INMR02,IPRR,IPRW
COMMON/NMRSTF/INTREQ,IRLREQ,LNMR01,INMR02,IPRR,IPRW


DOUBLE PRECISION TGTRMSD,TGTMDFRC
COMMON/TMD_REAL/ TGTRMSD,TGTMDFRC

!LOGICAL CALLEDONCE      ! JUST CALL SUBROUTINE AMBERINTERFACE ONCE
!COMMON/LOGICALS/ CALLEDONCE

! SF344> EXTRA VARIABLES ADDED TO TURN ON/OFF THE CONTINUOUS SMOOTHING OF NON-BONDED TERMS
!       (THAT IS: FORCE SWITCHING FOR THE ELECTROSTATICS, STODDARD-FORD FOR THE VAN DER WAALS TERMS)

INTEGER IFSWITCH, IRESPA2, NRESPA2
DOUBLE PRECISION FSWITCHBETA
!DOUBLE PRECISION, DIMENSION (:,:),ALLOCATABLE :: DEDRCUT,ECUT
COMMON/EXTRASAMBERINT/IFSWITCH,IRESPA2,NRESPA2
COMMON/EXTRASAMBERDP/FSWITCHBETA

!MSB50
INTEGER, DIMENSION(:,:),ALLOCATABLE:: IC_COORDS
CHARACTER(LEN=3), DIMENSION(:), ALLOCATABLE:: IC_IMPROP
INTEGER:: LENIC
INTEGER, DIMENSION(:), ALLOCATABLE :: NPHIPSI
INTEGER, DIMENSION(:), ALLOCATABLE :: NOMEGAC
INTEGER, DIMENSION(:), ALLOCATABLE :: NSIDECHAIN
INTEGER, DIMENSION(:), ALLOCATABLE :: NCHIRAL
INTEGER, DIMENSION(:), ALLOCATABLE :: PHIPSI
INTEGER, DIMENSION(:), ALLOCATABLE :: OMEGAC
INTEGER, DIMENSION(:), ALLOCATABLE :: TW_SIDECHAIN
INTEGER, DIMENSION(:), ALLOCATABLE :: CHIRAL
LOGICAL, DIMENSION(:), ALLOCATABLE :: IS_SIDECHAIN
INTEGER, DIMENSION(:), ALLOCATABLE :: NICTOT !NO OF RESIDUES PER SEGMENT
INTEGER:: NSEG
LOGICAL:: TOMEGAC
LOGICAL:: AMBERICT, AMBSTEPT, AMBPERTT,AMBIT, AMBOLDPERTT
DOUBLE PRECISION:: PERTHRESH !THRESHHOLD FOR DIHEDRAL PERTURBATION
                    !PERTURB IF DIFFERENCE (START-END) > PERTHRESH
INTEGER:: NTW_ANGLES !IF AMBPERTT: HOW MANY ANGLES CAN YOU REALLY TWIST
DOUBLE PRECISION, DIMENSION(:), ALLOCATABLE :: TW_DIFFP
LOGICAL :: INTMINPERMT=.FALSE.

!
! VARIABLES FOR STEERED MINIMISATION/GROUPING.
!
LOGICAL :: STEEREDMINT, LOCALSTEEREDMINT
INTEGER :: SMINATOMA, SMINATOMB
DOUBLE PRECISION :: SMINK, SMINKINC, SMINDISTSTART, SMINDISTFINISH, SMINKCURRENT
!   ATOM GROUPS FOR STEERED MINIMISATION
INTEGER :: NATOMSINA, NATOMSINB, NATOMSINC
INTEGER,ALLOCATABLE,DIMENSION(:) :: ATOMSINALIST, ATOMSINBLIST, ATOMSINCLIST  
LOGICAL,ALLOCATABLE,DIMENSION(:) :: ATOMSINALISTLOGICAL, ATOMSINBLISTLOGICAL, ATOMSINCLISTLOGICAL
!LOGICAL :: BHDEBUG
!DOUBLE PRECISION :: BHSTEPSIZE
DOUBLE PRECISION :: AMCHNMAX, AMCHNMIN, AMCHPMAX, AMCHPMIN
! FREEZING IN AMBER TO SPEED UP ENDHESS
LOGICAL, ALLOCATABLE,DIMENSION(:) :: FROZENAMBER

END MODULE MODAMBER9 

