C   GMIN: A PROGRAM FOR FINDING GLOBAL MINIMA
C   COPYRIGHT (C) 1999-2006 DAVID J. WALES
C   THIS FILE IS PART OF GMIN.
C
C   GMIN IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C   IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C   THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
C   (AT YOUR OPTION) ANY LATER VERSION.
C
C   GMIN IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL,
C   BUT WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
C   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.  SEE THE
C   GNU GENERAL PUBLIC LICENSE FOR MORE DETAILS.
C
C   YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
C   ALONG WITH THIS PROGRAM; IF NOT, WRITE TO THE FREE SOFTWARE
C   FOUNDATION, INC., 59 TEMPLE PLACE, SUITE 330, BOSTON, MA  02111-1307  USA
C
C
C DERIVATIVES OF R(I,J) WITH RESPECT TO RIGID BODY COORDINATES OF TWO
C MOLECULES X1,Y1,Z1,N1,L1,M1 AND X2,Y2,Z2,L2,M2,N2.
C P(I) = (P1X,P1Y,P1Z), P(J)=(P2X,P2Y,P2Z) ARE THE SITE CORDINATES IN
C THE REFERENCE GEOMETRY FOR THE MOLECULE AT THE ORIGIN AND RDIST IS THE
C ACTUAL DISTANCE BETWEEN THE TWO SITES IN QUESTION.
C
C THIS SHOULD ENABLE RIGID BODY SYSTEMS TO BE CODED IN A
C STRAIGHTFORWARD, SYSTEMATIC WAY.
C
      DOUBLE PRECISION FUNCTION D1(P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST,
     1                 C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22)
      IMPLICIT NONE
      DOUBLE PRECISION C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22
      DOUBLE PRECISION P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST

      D1=
     @    RDIST*(C2A1*P1X - C3A1*L1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2X + 
     @    C3A2*L2*(L2*P2X + M2*P2Y + N2*P2Z) + (N1*P1Y - M1*P1Z)*S1 - N2*P2Y*S2 + 
     @    M2*P2Z*S2 + X1 - X2)
      
      RETURN
      END

      DOUBLE PRECISION FUNCTION D2(P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST,
     1 C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22)
      IMPLICIT NONE
      DOUBLE PRECISION C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22
      DOUBLE PRECISION P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST

      D2=
     @    RDIST*(C2A1*P1Y - C3A1*M1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Y + 
     @    C3A2*M2*(L2*P2X + M2*P2Y + N2*P2Z) - N1*P1X*S1 + L1*P1Z*S1 + N2*P2X*S2 - 
     @    L2*P2Z*S2 + Y1 - Y2)

      RETURN
      END

      DOUBLE PRECISION FUNCTION D3(P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST,
     1 C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22)
      IMPLICIT NONE
      DOUBLE PRECISION C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22
      DOUBLE PRECISION P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST

      D3=
     @    RDIST*(C2A1*P1Z - C3A1*N1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Z + 
     @    C3A2*N2*(L2*P2X + M2*P2Y + N2*P2Z) + M1*P1X*S1 - L1*P1Y*S1 - M2*P2X*S2 + 
     @    L2*P2Y*S2 + Z1 - Z2)

      RETURN
      END


      DOUBLE PRECISION FUNCTION D4(P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST,
     1 C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22)
      IMPLICIT NONE
      DOUBLE PRECISION C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22
      DOUBLE PRECISION P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST

      D4=
     @      RDIST*((C3A1*(2*L1*P1X*(-1 + L12*RALPHA12) + 
     @            (M1*P1Y + N1*P1Z)*(-1 + 2*L12*RALPHA12)) + 
     @         (L1*L12*P1X + L12*M1*P1Y - L1*N1*P1Y + L1*M1*P1Z + L12*N1*P1Z)*
     @          RALPHA12*S1 + L1*(C2A1*(N1*P1Y - M1*P1Z)*RALPHA12 - P1X*S1))*
     @       (C2A1*P1X - C3A1*L1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2X + 
     @         C3A2*L2*(L2*P2X + M2*P2Y + N2*P2Z) + (N1*P1Y - M1*P1Z)*S1 - 
     @         N2*P2Y*S2 + M2*P2Z*S2 + X1 - X2) + 
     @      (C2A1*L1*(-(N1*P1X) + L1*P1Z)*RALPHA12 + 
     @         C3A1*M1*(-P1X + 2*L1*(L1*P1X + M1*P1Y + N1*P1Z)*RALPHA12) + 
     @         (-(L1*P1Y) + P1Z + L1* (L1*M1*P1X + N1*P1X + M1**2*P1Y - L1*P1Z + M1*N1*P1Z)*RALPHA12)*
     @          S1)*(C2A1*P1Y - C3A1*M1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Y + 
     @         C3A2*M2*(L2*P2X + M2*P2Y + N2*P2Z) - N1*P1X*S1 + L1*P1Z*S1 + 
     @         N2*P2X*S2 - L2*P2Z*S2 + Y1 - Y2) + 
     @      (-(C2A1*L1*(-(M1*P1X) + L1*P1Y)*RALPHA12) + 
     @         C3A1*N1*(-P1X + 2*L1*(L1*P1X + M1*P1Y + N1*P1Z)*RALPHA12) + 
     @         (-P1Y - L1*P1Z + L1*(-(M1*P1X) + L1*N1*P1X + L1*P1Y + M1*N1*P1Y + N1**2*P1Z)*RALPHA12)*S1)*
     @       (C2A1*P1Z - C3A1*N1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Z + 
     @         C3A2*N2*(L2*P2X + M2*P2Y + N2*P2Z) + M1*P1X*S1 - L1*P1Y*S1 - 
     @         M2*P2X*S2 + L2*P2Y*S2 + Z1 - Z2))

      RETURN
      END

      DOUBLE PRECISION FUNCTION D5(P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST,
     1 C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22)
      IMPLICIT NONE
      DOUBLE PRECISION C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22
      DOUBLE PRECISION P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST

      D5=
     @ RDIST*((-(C2A1*M1*(-(N1*P1Y) + M1*P1Z)*RALPHA12) + 
     @         C3A1*L1*(-P1Y + 2*M1*(L1*P1X + M1*P1Y + N1*P1Z)*RALPHA12) + 
     @         (-(M1*P1X) - P1Z + M1* (L1**2*P1X + L1*M1*P1Y - N1*P1Y + M1*P1Z + L1*N1*P1Z)*RALPHA12)*
     @          S1)*(C2A1*P1X - C3A1*L1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2X + 
     @         C3A2*L2*(L2*P2X + M2*P2Y + N2*P2Z) + (N1*P1Y - M1*P1Z)*S1 - 
     @         N2*P2Y*S2 + M2*P2Z*S2 + X1 - X2) + (-(C3A1*(L1*P1X + 2*M1*P1Y + N1*P1Z)) + 
     @         C2A1*M1*(-(N1*P1X) + L1*P1Z)*RALPHA12 + 2*C3A1*M12*(L1*P1X + M1*P1Y + N1*P1Z)*RALPHA12 + 
     @         (-(M1*P1Y) + (L1*M12*P1X + M1*N1*P1X + M1*M12*P1Y - L1*M1*P1Z + 
     @               M12*N1*P1Z)*RALPHA12)*S1)*
     @       (C2A1*P1Y - C3A1*M1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Y + 
     @         C3A2*M2*(L2*P2X + M2*P2Y + N2*P2Z) - N1*P1X*S1 + L1*P1Z*S1 + 
     @         N2*P2X*S2 - L2*P2Z*S2 + Y1 - Y2) + (C2A1*M1*(M1*P1X - L1*P1Y)*RALPHA12 + 
     @         C3A1*N1*(-P1Y + 2*M1*(L1*P1X + M1*P1Y + N1*P1Z)*RALPHA12) + 
     @         (P1X - M1*(M1 - L1*N1)*P1X*RALPHA12 + 
     @            M1*((L1 + M1*N1)*P1Y*RALPHA12 + P1Z*(-1 + N1**2*RALPHA12)))*S1)*
     @       (C2A1*P1Z - C3A1*N1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Z + 
     @         C3A2*N2*(L2*P2X + M2*P2Y + N2*P2Z) + M1*P1X*S1 - L1*P1Y*S1 - 
     @         M2*P2X*S2 + L2*P2Y*S2 + Z1 - Z2))

      RETURN
      END

      DOUBLE PRECISION FUNCTION D6(P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST,
     1 C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22)
      IMPLICIT NONE
      DOUBLE PRECISION C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22
      DOUBLE PRECISION P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST

      D6=
     @ RDIST*((C2A1*N1*(N1*P1Y - M1*P1Z)*RALPHA12 + 
     @         C3A1*L1*(-P1Z + 2*N1*(L1*P1X + M1*P1Y + N1*P1Z)*RALPHA12) + (-(N1*P1X) + P1Y + N1*
     @             (L1**2*P1X + L1*M1*P1Y - N1*P1Y + M1*P1Z + L1*N1*P1Z)*RALPHA12)*
     @          S1)*(C2A1*P1X - C3A1*L1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2X + 
     @         C3A2*L2*(L2*P2X + M2*P2Y + N2*P2Z) + (N1*P1Y - M1*P1Z)*S1 - 
     @         N2*P2Y*S2 + M2*P2Z*S2 + X1 - X2) + 
     @      (-(C2A1*N1*(N1*P1X - L1*P1Z)*RALPHA12) + 
     @         C3A1*M1*(-P1Z + 2*N1*(L1*P1X + M1*P1Y + N1*P1Z)*RALPHA12) + 
     @         (-P1X - N1*P1Y + N1*(L1*M1*P1X + N1*P1X + M1**2*P1Y - L1*P1Z + 
     @               M1*N1*P1Z)*RALPHA12)*S1)*
     @       (C2A1*P1Y - C3A1*M1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Y + 
     @         C3A2*M2*(L2*P2X + M2*P2Y + N2*P2Z) - N1*P1X*S1 + L1*P1Z*S1 + 
     @         N2*P2X*S2 - L2*P2Z*S2 + Y1 - Y2) + 
     @      (-(C3A1*(L1*P1X + M1*P1Y + 2*N1*P1Z)) + 
     @         C2A1*N1*(M1*P1X - L1*P1Y)*RALPHA12 + 
     @         2*C3A1*N12*(L1*P1X + M1*P1Y + N1*P1Z)*RALPHA12 + 
     @         (-(N1*P1Z) + (-(M1*N1*P1X) + L1*N12*P1X + L1*N1*P1Y + M1*N12*P1Y + 
     @               N1*N12*P1Z)*RALPHA12)*S1)*
     @       (C2A1*P1Z - C3A1*N1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Z + 
     @         C3A2*N2*(L2*P2X + M2*P2Y + N2*P2Z) + M1*P1X*S1 - L1*P1Y*S1 - 
     @         M2*P2X*S2 + L2*P2Y*S2 + Z1 - Z2))

      RETURN
      END

      DOUBLE PRECISION FUNCTION D7(P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST,
     1 C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22)
      IMPLICIT NONE
      DOUBLE PRECISION C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22
      DOUBLE PRECISION P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST

      D7=
     @   -RDIST*(C2A1*P1X - C3A1*L1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2X + 
     @    C3A2*L2*(L2*P2X + M2*P2Y + N2*P2Z) + (N1*P1Y - M1*P1Z)*S1 - N2*P2Y*S2 + 
     @    M2*P2Z*S2 + X1 - X2)

      RETURN
      END

      DOUBLE PRECISION FUNCTION D8(P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST,
     1 C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22)
      IMPLICIT NONE
      DOUBLE PRECISION C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22
      DOUBLE PRECISION P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST

      D8=
     @   -RDIST*(C2A1*P1Y - C3A1*M1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Y + 
     @    C3A2*M2*(L2*P2X + M2*P2Y + N2*P2Z) - N1*P1X*S1 + L1*P1Z*S1 + N2*P2X*S2 - 
     @    L2*P2Z*S2 + Y1 - Y2)

      RETURN
      END

      DOUBLE PRECISION FUNCTION D9(P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST,
     1 C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22)
      IMPLICIT NONE
      DOUBLE PRECISION C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22
      DOUBLE PRECISION P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST

      D9=
     @   -RDIST*(C2A1*P1Z - C3A1*N1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Z + 
     @    C3A2*N2*(L2*P2X + M2*P2Y + N2*P2Z) + M1*P1X*S1 - L1*P1Y*S1 - M2*P2X*S2 + 
     @    L2*P2Y*S2 + Z1 - Z2)

      RETURN
      END

      DOUBLE PRECISION FUNCTION DA(P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST,
     1 C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22)
      IMPLICIT NONE
      DOUBLE PRECISION C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22
      DOUBLE PRECISION P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST

      DA=
     @         RDIST*((C3A2*(2*L2*P2X + M2*P2Y + N2*P2Z - 
     @            2*L22*(L2*P2X + M2*P2Y + N2*P2Z)*RALPHA22) - 
     @         (L2*L22*P2X + L22*M2*P2Y - L2*N2*P2Y + L2*M2*P2Z + L22*N2*P2Z)*
     @          RALPHA22*S2 + L2*(-(C2A2*N2*P2Y*RALPHA22) + C2A2*M2*P2Z*RALPHA22 + 
     @            P2X*S2))*(C2A1*P1X - C3A1*L1*(L1*P1X + M1*P1Y + N1*P1Z) - 
     @         C2A2*P2X + C3A2*L2*(L2*P2X + M2*P2Y + N2*P2Z) + 
     @         (N1*P1Y - M1*P1Z)*S1 - N2*P2Y*S2 + M2*P2Z*S2 + X1 - X2) + 
     @      (-(C2A2*L2*(-(N2*P2X) + L2*P2Z)*RALPHA22) + 
     @         C3A2*M2*(P2X - 2*L2*(L2*P2X + M2*P2Y + N2*P2Z)*RALPHA22) - (-(L2*P2Y) + P2Z + L2*
     @             (L2*M2*P2X + N2*P2X + M2**2*P2Y - L2*P2Z + M2*N2*P2Z)*RALPHA22)*
     @          S2)*(C2A1*P1Y - C3A1*M1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Y + 
     @         C3A2*M2*(L2*P2X + M2*P2Y + N2*P2Z) - N1*P1X*S1 + L1*P1Z*S1 + 
     @         N2*P2X*S2 - L2*P2Z*S2 + Y1 - Y2) + 
     @      (C2A2*L2*(-(M2*P2X) + L2*P2Y)*RALPHA22 + 
     @         C3A2*N2*(P2X - 2*L2*(L2*P2X + M2*P2Y + N2*P2Z)*RALPHA22) + 
     @    (P2Y + L2*P2Z - L2*(-(M2*P2X) + L2*N2*P2X + L2*P2Y + M2*N2*P2Y + N2**2*P2Z)*RALPHA22)*S2)*
     @       (C2A1*P1Z - C3A1*N1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Z + 
     @    C3A2*N2*(L2*P2X + M2*P2Y + N2*P2Z) + M1*P1X*S1 - L1*P1Y*S1 - M2*P2X*S2 + L2*P2Y*S2 + Z1 - Z2))

      RETURN
      END

      DOUBLE PRECISION FUNCTION DB(P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST,
     1 C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22)
      IMPLICIT NONE
      DOUBLE PRECISION C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22
      DOUBLE PRECISION P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST

      DB=
     @ RDIST*((C2A2*M2*(-(N2*P2Y) + M2*P2Z)*RALPHA22 + 
     @         C3A2*L2*(P2Y - 2*M2*(L2*P2X + M2*P2Y + N2*P2Z)*RALPHA22) + 
     @         (M2*P2X + P2Z - M2*(L2**2*P2X + L2*M2*P2Y - N2*P2Y + M2*P2Z + L2*N2*P2Z)*RALPHA22)*S2)*
     @       (C2A1*P1X - C3A1*L1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2X + 
     @         C3A2*L2*(L2*P2X + M2*P2Y + N2*P2Z) + (N1*P1Y - M1*P1Z)*S1 - 
     @         N2*P2Y*S2 + M2*P2Z*S2 + X1 - X2) + (C3A2*(L2*P2X + 2*M2*P2Y + N2*P2Z - 
     @            2*M22*(L2*P2X + M2*P2Y + N2*P2Z)*RALPHA22) - 
     @         (L2*M22*P2X + M2*N2*P2X + M2*M22*P2Y - L2*M2*P2Z + M22*N2*P2Z)*
     @          RALPHA22*S2 + M2*(C2A2*(N2*P2X - L2*P2Z)*RALPHA22 + P2Y*S2))*
     @       (C2A1*P1Y - C3A1*M1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Y + 
     @         C3A2*M2*(L2*P2X + M2*P2Y + N2*P2Z) - N1*P1X*S1 + L1*P1Z*S1 + 
     @         N2*P2X*S2 - L2*P2Z*S2 + Y1 - Y2) + (-(C2A2*M2*(M2*P2X - L2*P2Y)*RALPHA22) + 
     @         C3A2*N2*(P2Y - 2*M2*(L2*P2X + M2*P2Y + N2*P2Z)*RALPHA22) + 
     @         (-P2X + M2*P2Z - M2*(-(M2*P2X) + L2*N2*P2X + L2*P2Y + M2*N2*P2Y + 
     @               N2**2*P2Z)*RALPHA22)*S2)*
     @       (C2A1*P1Z - C3A1*N1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Z + 
     @         C3A2*N2*(L2*P2X + M2*P2Y + N2*P2Z) + M1*P1X*S1 - L1*P1Y*S1 - 
     @         M2*P2X*S2 + L2*P2Y*S2 + Z1 - Z2))

      RETURN
      END

      DOUBLE PRECISION FUNCTION DC(P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST,
     1 C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22)
      IMPLICIT NONE
      DOUBLE PRECISION C2A2,RALPHA12,RALPHA22,C3A2,S2,C2A1,C3A1,S1,N12,L12,M12,L22,M22,N22
      DOUBLE PRECISION P1X,P1Y,P1Z,P2X,P2Y,P2Z,X1,Y1,Z1,N1,L1,M1,X2,Y2,Z2,L2,M2,N2,RDIST

      DC=
     @ RDIST*((-(C2A2*N2*(N2*P2Y - M2*P2Z)*RALPHA22) + 
     @         C3A2*L2*(P2Z - 2*N2*(L2*P2X + M2*P2Y + N2*P2Z)*RALPHA22) + 
     @         (N2*P2X - P2Y - N2*(L2**2*P2X + L2*M2*P2Y - N2*P2Y + M2*P2Z + L2*N2*P2Z)*RALPHA22)*S2)*
     @       (C2A1*P1X - C3A1*L1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2X + 
     @         C3A2*L2*(L2*P2X + M2*P2Y + N2*P2Z) + (N1*P1Y - M1*P1Z)*S1 - 
     @         N2*P2Y*S2 + M2*P2Z*S2 + X1 - X2) + (C2A2*N2*(N2*P2X - L2*P2Z)*RALPHA22 + 
     @         C3A2*M2*(P2Z - 2*N2*(L2*P2X + M2*P2Y + N2*P2Z)*RALPHA22) + 
     @         (P2X + N2*P2Y - N2*(L2*M2*P2X + N2*P2X + M2**2*P2Y - L2*P2Z + M2*N2*P2Z)*RALPHA22)*S2)*
     @       (C2A1*P1Y - C3A1*M1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Y + 
     @         C3A2*M2*(L2*P2X + M2*P2Y + N2*P2Z) - N1*P1X*S1 + L1*P1Z*S1 + 
     @         N2*P2X*S2 - L2*P2Z*S2 + Y1 - Y2) + (C3A2*(L2*P2X + M2*P2Y + 2*N2*P2Z - 
     @            2*N22*(L2*P2X + M2*P2Y + N2*P2Z)*RALPHA22) + 
     @         (N2*(M2*P2X - L2*P2Y) - N22*(L2*P2X + M2*P2Y + N2*P2Z))*RALPHA22*
     @          S2 + N2*(-(C2A2*M2*P2X*RALPHA22) + C2A2*L2*P2Y*RALPHA22 + P2Z*S2))*
     @       (C2A1*P1Z - C3A1*N1*(L1*P1X + M1*P1Y + N1*P1Z) - C2A2*P2Z + 
     @         C3A2*N2*(L2*P2X + M2*P2Y + N2*P2Z) + M1*P1X*S1 - L1*P1Y*S1 - 
     @         M2*P2X*S2 + L2*P2Y*S2 + Z1 - Z2))

       RETURN
       END
