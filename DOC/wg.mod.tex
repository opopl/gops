\chapter{Models}

\subsection{Bond angles}

The definition of the bond angle is the following,
%, see \ref{def-bangle}.
\begin{equation}
  \cos\theta_{ijk}=\left[\frac{\rij\cdot\rkj}{r_{ij}r_{kj}}\right].
  \label{def-bangle}
\end{equation}
where $\rr_{ij}\equiv\rr_i-\rr_j,\quad r_{ij}\equiv|\rr_{ij}|$.
For a bond angle $\theta_a=\theta_{ijk},\quad a=2,\ldots,N-1$, 
one has $\rij=-\bb_{a-1},\quad\rkj=\bb_a$. Thus,
\begin{equation}
  \cos\theta_a=-\frac{\DPD(a-1)}{b_{a-1}b_{a}},\qquad a=2,\ldots,N-1  
  \label{def-bangle-a}
\end{equation}
where one defines the cross-product 
$\DPD(a)\equiv (\bb_a\cdot\bb_{a+1})$ for $a=1,\ldots,N-1$.
Then, the gradients read
\begin{align}
  \nn\Gi(\theta_a)&=-\frac{1}{b_{a-1}}f_a\frac{\mi}{|\mi|},\\
\nn\Gk(\theta_a)&=-\frac{1}{b_{a}}
  f_a\frac{\mk}{|\mk|},\\
  \Gj(\theta_a)&=-\Gi(\theta_a)-\Gk(\theta_a).
\end{align}
where the vectors $\mi$ and $\mk$ are defined as  
\begin{align}
 \mi\equiv\rij\times(\rkj\times\rij)=-\bb_{a-1}\times(\bb_{a-1}\times\bb_{a}), \\
  \mk\equiv\rkj\times(\rij\times\rkj)=-\bb_a\times(\bb_{a-1}\times\bb_a).
\label{def-mi-mk}
\end{align}
Simplifying the vector products by using the vector identity
$\v{A}\times(\v{B}\times\v{C})=\v{B}(\v{C}\cdot{\v{A}})-\v{C}(\v{B}\cdot{\v{A}})$, 
one obtains for the vectors $\mi$ and $\mk$,
\begin{align}
  -\mi&=\bb_{a-1}\DPD(a-1)-\bb_a b_{a-1}^2=-b_ab_{a-1}^2({\v{e}_{a-1}}\cos\theta_a+\v{e}_a)\\
  -\mk&=\bb_{a-1}b_a^2-\bb_a\DPD(a-1)=b_a^2b_{a-1}(\v{e}_{a-1}+\v{e}_a\cos\theta_a)\\
  |\mi|&=b_{a-1}\XPD(a-1)=b_{a-1}^2b_a\sin\theta_a\\
  |\mk|&=b_{a}\XPD(a-1)= b_{a}^2b_{a-1}\sin\theta_a
\end{align}
with $\v{e}_a\equiv\bb_a/b_a$. 
After substituting $\XPD(a-1)=b_ab_{a-1}\sin\theta_a,\quad \DPD(a-1)=-b_ab_{a-1}\cos\theta_a$,
the gradients read
\begin{align}
  \Gi(\theta_a)&=-\frac{1}{b_{a-1}}\frac{f_a}{\sin\theta_a}(\ee_{a-1}\cos\theta_a+\ee_a),\\
  \Gk(\theta_a)&=\frac{1}{b_{a}}\frac{f_a}{\sin\theta_a}(\ee_{a-1}+\ee_a\cos\theta_a).
\end{align}

\subsubsection{Gradients}

The connection between the 
bond angle gradients expressed through the Cartesian and the local 
coordinate systems is given by
\begin{align}
  \nn\GG{1}=&\Gi(\theta_2)\\
  \nn\GG{2}=&\Gi(\theta_3)+\Gj(\theta_2)\\
  \nn\GG{3}=&\Gi(\theta_4)+\Gj(\theta_3)+\Gk(\theta_2)\\
  \nn\ldots\\
  \nn\GG{a}=&\Gi(\theta_{a+1})+\Gj(\theta_a)+\Gk(\theta_{a-1}),\quad a=3,\ldots,N-2\\
  \nn\ldots\\
  \nn\GG{N-2}=&\Gi(\theta_{N-1})+\Gj(\theta_{N-2})+\Gk(\theta_{N-3})\\
  \nn\GG{N-1}=&\Gj(\theta_{N-1})+\Gk(\theta_{N-2})\\
  \GG{N}=&\Gk(\theta_{N-1})
\end{align}

\subsubsection{Formulas for Bond Angle Gradients}

%\paragraph{$a=1$}
%\begin{align}
  %\nn\GG{1}&=\Gi(\theta_2)=
%\end{align}
%\paragraph{$a=2$} 
  %\begin{align}
    %\nn\GG{2}&=-f_3\HVXPD(2)\frac{b_3}{\XPD(2)}+\HVXPD(1)f_2\frac{b_2}{\XPD(1)}
    %\left(1-\frac{\DPD(1)}{b_2^2}\right)+
    %f_2\HVXPD(2)\frac{\DPD(2)}{b_2\XPD(2)}\\
    %\nn&=\HVXPD(2)\left(\frac{f_2\DPD(2)}{b_2\XPD(2)}-\frac{f_3b_3}{\XPD(2)}\right)
    %+\HVXPD(1)\frac{f_2b_2}{\XPD(1)}\left(1-\frac{\DPD(1)}{b_2^2}\right)\\
    %&=\pp_2\left[ -f_3b_3+\DPD(2)\frac{f_2}{b_2}\right]\\
    %&+\pp_1\left[f_2b_2-\DPD(1)\frac{f_2}{b_2}\right]
  %\end{align}
%\paragraph{$a=3$}
  %\begin{align}
    %\nn\GG{4}&=
    %\HVXPD(3)\left(\frac{f_3\DPD(3)}{b_3\XPD(3)}-\frac{f_4b_4}{\XPD(3)}\right)
    %+\HVXPD(2)\frac{f_3b_3}{\XPD(2)}\left(1-\frac{\DPD(2)}{b_3^2}\right)\\
    %&+\HVXPD(1)\frac{f_2\DPD(1)}{b_2\XPD(1)}
    %-\HVXPD(2)\frac{f_2b_{2}}{\XPD(2)}\left(1+\frac{\DPD(2)}{b_2^2}\right)\\
    %&= \pp_3
    %\left(\frac{f_3\DPD(3)}{b_3}-f_4b_4\right)\\
    %&+\pp_2\left[b_3f_3-b_2f_2-
    %\DPD(2)\left(\frac{f_3}{b_3}+\frac{f_2}{b_2}\right)\right]\\
    %&+\pp_1\frac{f_2\DPD(1)}{b_2},
  %\end{align}
  %where
  %\begin{equation}
    %\pp_a\equiv\frac{\VXPD(a)}{\XPD(a)^2},\quad a=1,\ldots,N-2
  %\end{equation}

%\paragraph{General formula for $a$}. 

%We will need the formula for $\Gl$, \eqref{my-Gl}
  %\begin{align}
    %%\nn\GG{a}&=\GG{a-1}+\Gl(\phi_{a-2})-\Gl(\phi_{a-3})
    %\nn\Gl(\phi_{a-2})=\pp_{a-2}b_{a-2}
%\end{align}
%so the general formula for all $a\in[1,N]$ reads
%\begin{align}
  %\GG{a}&=
  %\pp_a
    %\left(\DPD(a)\frac{f_a}{b_a}-f_{a+1}b_{a+1}\right)\\
    %&+\pp_{a-1}\left[b_{a}f_a-b_{a-1}f_{a-1}-
    %\DPD(a-1)\left(\frac{f_a}{b_a}+\frac{f_{a-1}}{b_{a-1}}\right)\right]\\
    %&+\pp_{a-2}\left[\DPD(a-2)\frac{f_{a-1}}{b_{a-1}}+f_{a-2}b_{a-2}\right],
%\end{align}
%with an additional convention that $f_{-1}=f_0=f_1=f_{N-1}=f_N=0$.
%From this, we infer the gradients for the remaining cases $a=N-2,\ N-1,\ N$.

%\paragraph{$a=N-2$}

  %\begin{align}
    %\nn\GG{N-2}&=
    %\pp_{N-2}
    %\DPD(N-2)\frac{f_{N-2}}{b_{N-2}}\\
    %&+\pp_{N-3}\left[b_{N-2}f_{N-2}-b_{N-3}f_{N-3}-
    %\DPD(N-3)\left(\frac{f_{N-2}}{b_{N-2}}+\frac{f_{N-3}}{b_{N-3}}\right)\right]\\
    %&+\pp_{N-4}\left(\DPD(N-4)\frac{f_{N-3}}{b_{N-3}}+f_{N-4}b_{N-4}\right),
  %\end{align}

%\paragraph{$a=N-1$}

  %\begin{align}
    %\nn\GG{N-1}&=
    %\pp_{N-2}\left[-b_{N-2}f_{N-2}-
    %\DPD(N-2)\left(\frac{f_{N-2}}{b_{N-2}}\right)\right]\\
    %&+\pp_{N-3}\left(\DPD(N-3)\frac{f_{N-2}}{b_{N-2}}+f_{N-3}b_{N-3}\right),
  %\end{align}

%\paragraph{$a=N$}
 %\begin{align}
    %\nn\GG{N}&=
    %\pp_{N-2}f_{N-2}b_{N-2},
  %\end{align}




\subsection{Torsion angles}

\subsubsection{Torsional angles}

Torsional angle $\phi$ is defined through the dot-product of two normal vectors,
\begin{equation}
  \cos\phi_{a}=-(\HVXPD(a-1),\HVXPD(a)),\quad a=2,\ldots,N-2,
\end{equation}
where
\begin{equation}
\VXPD(a)\equiv (\bb_a\times\bb_{a+1}),\quad
\XPD(a)\equiv|(\bb_a\times\bb_{a+1})|,
\end{equation}
and
\begin{equation}
  \hv{n}\equiv \frac{\v{n}}{|\v{n}|}.
\end{equation}

It is possible to express $\XPD$ through $\DPD$:
\begin{equation}
  \XPD^2(i)\equiv\ (\bb_i\times\bb_{i+1})^2
  =b_i^2b_{i+1}^2-(\bb_i,\bb_{i+1})^2
  =b_i^2b_{i+1}^2-\DPD(i)^2.
\end{equation}

\subsubsection{Bekker formulas}

We will also need \cite{Bekker95}
\begin{align}
  \label{Bekker-Gi}\Gi\quad=&\quad \frac{dV(\phi)}{d\phi}r_{kj}\frac{\v{m}}{|\v{m}|^2}\\
  \label{Bekker-Gl}\Gl\quad=&\quad-\frac{dV(\phi)}{d\phi}r_{kj}\frac{\v{n}}{|\v{n}|^2}\\
\Gj\quad=&\quad-\Gi +\left(\frac{\v{r}_{ij}\cdot{\v{r}_{kj}}}{r_{kj}^2}\right)\Gi
  -\left(\frac{\v{r}_{kl}\cdot{\v{r}_{kj}}}{r_{kj}^2}\right)\Gl\\
  \label{Bekker-Gk}\Gk\quad=&\quad-\Gl
  -\left(\frac{\v{r}_{ij}\cdot{\v{r}_{kj}}}{r_{kj}^2}\right)\Gi
  +\left(\frac{\v{r}_{kl}\cdot{\v{r}_{kj}}}{r_{kj}^2}\right)\Gl\\
\v{m}\quad\equiv&\quad\v{r}_{ij}\times\v{r}_{kj}\\
\v{n}\quad\equiv&\quad\v{r}_{kj}\times\v{r}_{kl}
\end{align}

\clearpage
\subsubsection{Torsion angles vs gradients }

For $a=2,\ldots,N-2$
\begin{align}
  \label{my-Gi}
  \Gi(\phi_a)&=-\HVXPD(a-1)\frac{b_{a}}{\XPD(a-1)}  \\
  \label{my-Gl}
  \Gl(\phi_a)&=\HVXPD(a)\frac{b_{a}}{\XPD(a)} \\
  \nn\Gj(\phi_a)&=-\HVXPD(a-1)\frac{b_{a}}{\XPD(a-1)}
  \left(-1+\frac{\DPD(a-1)}{b_a^2}\right)\\
  \nn&+\frac{\DPD(a)}{b_a^2}\Gl(\phi_a)\\
  \label{my-Gj}
  &=\HVXPD(a-1)\frac{b_{a}}{\XPD(a-1)}\left(1-\frac{\DPD(a-1)}{b_a^2}\right)
  +\HVXPD(a)\frac{\DPD(a)}{b_a\XPD(a)}\\
  \nn\Gk(\phi_a)&=\HVXPD(a-1)\frac{\DPD(a-1)}{b_a\XPD(a-1)}-\left(1+\frac{\DPD(a)}{b_a^2}\right)\Gl(\phi_a)\\
  \label{my-Gk}
  &=\HVXPD(a-1)\frac{\DPD(a-1)}{b_a\XPD(a-1)}-
  \HVXPD(a)\frac{b_{a}}{\XPD(a)}\left(1+\frac{\DPD(a)}{b_a^2}\right)
\end{align}

\subsubsection{Gradient sum rule}
Let us check that the sum rule is satisfied:
\begin{equation}
  \Gi(\phi_a)+\Gj(\phi_a)+\Gl(\phi_a)+\Gk(\phi_a)=0
\end{equation}
\begin{align}
\Gi(\phi_a)+\Gj(\phi_a)&=\HVXPD(a)\frac{\DPD(a)}{b_a\XPD(a)}-
\HVXPD(a-1)\frac{\DPD(a-1)}{b_a\XPD(a-1)}\\
\Gl(\phi_a)+\Gk(\phi_a)&=-\HVXPD(a)\frac{\DPD(a)}{b_a\XPD(a)}+
\HVXPD(a-1)\frac{\DPD(a-1)}{b_a\XPD(a-1)}
\end{align}

\clearpage
\subsubsection{Gradients vs torsional angles}

\begin{align}
  \nn\GG{1}=&\Gi(\phi_2)\\
  \nn\GG{2}=&\Gi(\phi_3)+\Gj(\phi_2)\\
  \nn\GG{3}=&\Gi(\phi_4)+\Gj(\phi_3)+\Gk(\phi_2)\\
  \nn\GG{4}=&\Gi(\phi_5)+\Gj(\phi_4)+\Gk(\phi_3)+\Gl(\phi_2)\\
  \nn\ldots\\
  \nn\GG{a}=&\Gi(\phi_{a+1})+\Gj(\phi_a)+\Gk(\phi_{a-1})+\Gl(\phi_{a-2}),\quad a=4,\ldots,N-3\\
  \nn\ldots\\
  \nn\GG{N-3}=&\Gi(\phi_{N-2})+\Gj(\phi_{N-3})+\Gk(\phi_{N-4})+\Gl(\phi_{N-5})\\
  \nn\GG{N-2}=&\Gj(\phi_{N-2})+\Gk(\phi_{N-3})+\Gl(\phi_{N-4})\\
  \nn\GG{N-1}=&\Gk(\phi_{N-2})+\Gl(\phi_{N-3})\\
  \GG{N}=&\Gl(\phi_{N-2})
\end{align}

\subsubsection{Formulas for Torsion Gradients}

We will denote $f_a\equiv dV(\phi)/d\phi|_{\phi=\phi_a}$.

%For $V(\phi)=A(1+\cos\phi)+B(1+\cos{3\phi})$, this yields:
\paragraph{$a=1$}
\begin{align}
  \nn\GG{1}&=-f_2\HVXPD(1)\frac{b_2}{\XPD(1)}\\
	&=-\pp_1f_2b_2
\end{align}
\paragraph{$a=2$} 
  \begin{align}
    \nn\GG{2}&=-f_3\HVXPD(2)\frac{b_3}{\XPD(2)}+\HVXPD(1)f_2\frac{b_2}{\XPD(1)}
    \left(1-\frac{\DPD(1)}{b_2^2}\right)+
    f_2\HVXPD(2)\frac{\DPD(2)}{b_2\XPD(2)}\\
    \nn&=\HVXPD(2)\left(\frac{f_2\DPD(2)}{b_2\XPD(2)}-\frac{f_3b_3}{\XPD(2)}\right)
    +\HVXPD(1)\frac{f_2b_2}{\XPD(1)}\left(1-\frac{\DPD(1)}{b_2^2}\right)\\
    &=\pp_2\left[ -f_3b_3+\DPD(2)\frac{f_2}{b_2}\right]\\
    &+\pp_1\left[f_2b_2-\DPD(1)\frac{f_2}{b_2}\right]
  \end{align}
\paragraph{$a=3$}
  \begin{align}
    \nn\GG{4}&=
    \HVXPD(3)\left(\frac{f_3\DPD(3)}{b_3\XPD(3)}-\frac{f_4b_4}{\XPD(3)}\right)
    +\HVXPD(2)\frac{f_3b_3}{\XPD(2)}\left(1-\frac{\DPD(2)}{b_3^2}\right)\\
    &+\HVXPD(1)\frac{f_2\DPD(1)}{b_2\XPD(1)}
    -\HVXPD(2)\frac{f_2b_{2}}{\XPD(2)}\left(1+\frac{\DPD(2)}{b_2^2}\right)\\
    &= \pp_3
    \left(\frac{f_3\DPD(3)}{b_3}-f_4b_4\right)\\
    &+\pp_2\left[b_3f_3-b_2f_2-
    \DPD(2)\left(\frac{f_3}{b_3}+\frac{f_2}{b_2}\right)\right]\\
    &+\pp_1\frac{f_2\DPD(1)}{b_2},
  \end{align}
  where
  \begin{equation}
    \pp_a\equiv\frac{\VXPD(a)}{\XPD(a)^2},\quad a=1,\ldots,N-2
  \end{equation}

\paragraph{General formula for $a$}. 

We will need the formula for $\Gl$, \eqref{my-Gl}
  \begin{align}
    %\nn\GG{a}&=\GG{a-1}+\Gl(\phi_{a-2})-\Gl(\phi_{a-3})
    \nn\Gl(\phi_{a-2})=\pp_{a-2}b_{a-2}
\end{align}
so the general formula for all $a\in[1,N]$ reads
\begin{align}
  \GG{a}&=
  \pp_a
    \left(\DPD(a)\frac{f_a}{b_a}-f_{a+1}b_{a+1}\right)\\
    &+\pp_{a-1}\left[b_{a}f_a-b_{a-1}f_{a-1}-
    \DPD(a-1)\left(\frac{f_a}{b_a}+\frac{f_{a-1}}{b_{a-1}}\right)\right]\\
    &+\pp_{a-2}\left[\DPD(a-2)\frac{f_{a-1}}{b_{a-1}}+f_{a-2}b_{a-2}\right],
\end{align}
with an additional convention that $f_{-1}=f_0=f_1=f_{N-1}=f_N=0$.
From this, we infer the gradients for the remaining cases $a=N-2,\ N-1,\ N$.

\paragraph{$a=N-2$}

  \begin{align}
    \nn\GG{N-2}&=
    \pp_{N-2}
    \DPD(N-2)\frac{f_{N-2}}{b_{N-2}}\\
    &+\pp_{N-3}\left[b_{N-2}f_{N-2}-b_{N-3}f_{N-3}-
    \DPD(N-3)\left(\frac{f_{N-2}}{b_{N-2}}+\frac{f_{N-3}}{b_{N-3}}\right)\right]\\
    &+\pp_{N-4}\left(\DPD(N-4)\frac{f_{N-3}}{b_{N-3}}+f_{N-4}b_{N-4}\right),
  \end{align}

\paragraph{$a=N-1$}

  \begin{align}
    \nn\GG{N-1}&=
    \pp_{N-2}\left[-b_{N-2}f_{N-2}-
    \DPD(N-2)\left(\frac{f_{N-2}}{b_{N-2}}\right)\right]\\
    &+\pp_{N-3}\left(\DPD(N-3)\frac{f_{N-2}}{b_{N-2}}+f_{N-3}b_{N-3}\right),
  \end{align}

\paragraph{$a=N$}
 \begin{align}
    \nn\GG{N}&=
    \pp_{N-2}f_{N-2}b_{N-2},
  \end{align}


\subsection{Determination of the global minimum}


